<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”¥ ç†±é–€è‚¡ç¥¨ - è‚¡æµ·ç§˜æ›¸</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans TC', sans-serif; }
    body { background: #0d1117; min-height: 100vh; color: #e6edf3; }
    .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
    .header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background: #161b22; border-radius: 12px; margin-bottom: 20px; border: 1px solid #30363d; }
    .header h1 { font-size: 1.4rem; color: #f85149; }
    .back-link { color: #58a6ff; text-decoration: none; font-size: 0.9rem; }
    .btn { padding: 8px 16px; border-radius: 6px; border: none; background: #21262d; color: #c9d1d9; cursor: pointer; }
    .btn:hover { background: #30363d; }
    .tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
    .tab { padding: 10px 20px; border-radius: 8px; border: 1px solid #30363d; background: #21262d; color: #c9d1d9; cursor: pointer; }
    .tab.active { background: #f85149; border-color: #f85149; color: white; }
    .stock-list { display: flex; flex-direction: column; gap: 8px; }
    .stock-item { background: #161b22; border: 1px solid #30363d; border-radius: 10px; padding: 14px 20px; display: grid; grid-template-columns: 40px 1fr auto auto; gap: 16px; align-items: center; cursor: pointer; transition: all 0.2s; }
    .stock-item:hover { border-color: #58a6ff; transform: translateX(4px); }
    .stock-item .rank { font-size: 1.2rem; font-weight: 700; color: #d29922; }
    .stock-item .rank.gold { color: #ffd700; }
    .stock-item .rank.silver { color: #c0c0c0; }
    .stock-item .rank.bronze { color: #cd7f32; }
    .stock-item .info .name { font-weight: 600; color: #c9d1d9; }
    .stock-item .info .code { font-size: 0.8rem; color: #8b949e; }
    .stock-item .price { font-size: 1.1rem; font-weight: 600; text-align: right; }
    .stock-item .change { font-weight: 600; min-width: 80px; text-align: right; }
    .stock-item .change.up { color: #f85149; }
    .stock-item .change.down { color: #3fb950; }
    .loading { text-align: center; padding: 40px; color: #8b949e; }
    .spinner { width: 30px; height: 30px; border: 3px solid #30363d; border-top-color: #f85149; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 12px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .status { text-align: center; padding: 10px; color: #8b949e; font-size: 0.85rem; }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div><a href="analysis.html" class="back-link">â† è¿”å›åˆ†æä¸­å¿ƒ</a><h1>ğŸ”¥ ç†±é–€è‚¡ç¥¨</h1></div>
      <button class="btn" onclick="loadData()">ğŸ”„ æ›´æ–°</button>
    </header>
    <div class="tabs">
      <div class="tab active" data-type="volume">æˆäº¤é‡</div>
      <div class="tab" data-type="up">æ¼²å¹…æ¦œ</div>
      <div class="tab" data-type="down">è·Œå¹…æ¦œ</div>
    </div>
    <div id="status" class="status"></div>
    <div id="stockList" class="stock-list">
      <div class="loading"><div class="spinner"></div><p>è¼‰å…¥ä¸­...</p></div>
    </div>
  </div>
  <script>
    const hotStocks = ['2330', '2317', '2454', '2603', '2881', '2303', '2882', '2412', '2891', '3711'];
    let currentType = 'volume';
    let stockData = [];
    
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentType = tab.dataset.type;
        renderList();
      });
    });
    
    async function fetchStock(id) {
      try {
        const res = await fetch(`/api/line/wave/analyze/${id}`);
        const data = await res.json();
        if (!data.error) {
          return {
            id,
            name: data.stockName,
            price: data.currentPrice,
            change: data.changePercent,
            volume: data.history?.[data.history.length - 1]?.volume || 0
          };
        }
      } catch (e) {}
      return null;
    }
    
    async function loadData() {
      document.getElementById('stockList').innerHTML = '<div class="loading"><div class="spinner"></div><p>è¼‰å…¥ä¸­...</p></div>';
      document.getElementById('status').textContent = 'â³ è¼‰å…¥ä¸­...';
      
      // ä¸¦è¡Œè¼‰å…¥
      const results = await Promise.all(hotStocks.map(id => fetchStock(id)));
      stockData = results.filter(r => r !== null);
      
      document.getElementById('status').textContent = `âœ… å·²è¼‰å…¥ ${stockData.length} æª”è‚¡ç¥¨`;
      setTimeout(() => { document.getElementById('status').textContent = ''; }, 3000);
      
      renderList();
    }
    
    function renderList() {
      let sorted = [...stockData];
      if (currentType === 'volume') {
        sorted.sort((a, b) => b.volume - a.volume);
      } else if (currentType === 'up') {
        sorted.sort((a, b) => b.change - a.change);
      } else {
        sorted.sort((a, b) => a.change - b.change);
      }
      
      if (sorted.length === 0) {
        document.getElementById('stockList').innerHTML = '<div class="loading">æš«ç„¡è³‡æ–™</div>';
        return;
      }
      
      document.getElementById('stockList').innerHTML = sorted.map((s, i) => {
        const rankClass = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
        const isUp = s.change >= 0;
        return `
          <div class="stock-item" onclick="location.href='wave.html?stock=${s.id}'">
            <div class="rank ${rankClass}">${i + 1}</div>
            <div class="info"><div class="name">${s.name}</div><div class="code">${s.id}</div></div>
            <div class="price" style="color:${isUp ? '#f85149' : '#3fb950'};">$${s.price?.toFixed(2) || '--'}</div>
            <div class="change ${isUp ? 'up' : 'down'}">${isUp ? 'â–²' : 'â–¼'} ${Math.abs(s.change).toFixed(2)}%</div>
          </div>
        `;
      }).join('');
    }
    
    loadData();
  </script>
</body>
</html>
