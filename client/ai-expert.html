<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¤– AI å°ˆå®¶å»ºè­° - è‚¡æµ·ç§˜æ›¸</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans TC', sans-serif; }
    body { background: #0d1117; min-height: 100vh; color: #e6edf3; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background: #161b22; border-radius: 12px; margin-bottom: 20px; border: 1px solid #30363d; flex-wrap: wrap; gap: 12px; }
    .header h1 { font-size: 1.4rem; color: #a371f7; }
    .search-box { display: flex; gap: 10px; }
    .search-box input { padding: 10px 16px; border-radius: 8px; border: 1px solid #30363d; background: #0d1117; color: #e6edf3; width: 120px; }
    .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; background: #a371f7; color: white; }
    .btn:hover { background: #8957e5; }
    .back-link { color: #58a6ff; text-decoration: none; font-size: 0.9rem; }
    
    .stock-info { background: #161b22; border-radius: 12px; border: 1px solid #30363d; padding: 20px; margin-bottom: 20px; text-align: center; }
    .stock-info .name { font-size: 1.5rem; font-weight: 700; color: #c9d1d9; }
    .stock-info .price { font-size: 2rem; font-weight: 700; color: #58a6ff; margin: 8px 0; }
    .stock-info .change { font-size: 1rem; }
    .stock-info .change.up { color: #f85149; }
    .stock-info .change.down { color: #3fb950; }
    .stock-info .wave { margin-top: 8px; color: #d29922; }
    
    .ai-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 20px; }
    @media (min-width: 992px) { .ai-grid { grid-template-columns: repeat(3, 1fr); } }
    .ai-card { background: #161b22; border-radius: 12px; border: 1px solid #30363d; overflow: hidden; }
    .ai-card-header { padding: 16px 20px; display: flex; align-items: center; gap: 12px; }
    .ai-card-header.claude { background: linear-gradient(135deg, #a371f7 0%, #8957e5 100%); }
    .ai-card-header.gemini { background: linear-gradient(135deg, #58a6ff 0%, #1f6feb 100%); }
    .ai-card-header.openai { background: linear-gradient(135deg, #3fb950 0%, #238636 100%); }
    .ai-avatar { width: 48px; height: 48px; border-radius: 50%; background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
    .ai-info .ai-name { font-size: 1.1rem; font-weight: 700; color: white; }
    .ai-info .ai-role { font-size: 0.85rem; color: rgba(255,255,255,0.8); }
    .ai-card-body { padding: 20px; }
    .ai-direction { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
    .direction-badge { padding: 8px 16px; border-radius: 8px; font-weight: 700; font-size: 1.1rem; }
    .direction-badge.up { background: rgba(248,81,73,0.2); color: #f85149; }
    .direction-badge.down { background: rgba(63,185,80,0.2); color: #3fb950; }
    .direction-badge.neutral { background: rgba(139,148,158,0.2); color: #8b949e; }
    .ai-reason { color: #c9d1d9; font-size: 0.95rem; line-height: 1.8; text-align: justify; }
    .ai-reason p { margin-bottom: 12px; }
    .ai-reason p:last-child { margin-bottom: 0; }
    .ai-section { margin-top: 16px; padding-top: 16px; border-top: 1px solid #30363d; }
    .ai-section-title { color: #58a6ff; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem; }
    .ai-confidence { margin-top: 16px; padding-top: 16px; border-top: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
    .confidence-bar { flex: 1; height: 8px; background: #21262d; border-radius: 4px; margin: 0 12px; overflow: hidden; }
    .confidence-fill { height: 100%; border-radius: 4px; }
    
    .summary-card { background: #161b22; border-radius: 12px; border: 2px solid #a371f7; padding: 24px; margin-bottom: 20px; }
    .summary-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; flex-wrap: wrap; gap: 12px; }
    .summary-header h2 { color: #a371f7; font-size: 1.2rem; }
    .final-direction { padding: 12px 24px; border-radius: 8px; font-weight: 700; font-size: 1.3rem; }
    .final-direction.up { background: rgba(248,81,73,0.2); color: #f85149; }
    .final-direction.down { background: rgba(63,185,80,0.2); color: #3fb950; }
    .final-direction.neutral { background: rgba(139,148,158,0.2); color: #8b949e; }
    .summary-content { color: #c9d1d9; line-height: 1.8; }
    .summary-content p { margin-bottom: 12px; }
    .vote-result { display: flex; gap: 16px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #30363d; flex-wrap: wrap; }
    .vote-item { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: #8b949e; }
    
    .loading { text-align: center; padding: 60px; color: #8b949e; }
    .spinner { width: 50px; height: 50px; border: 4px solid #30363d; border-top-color: #a371f7; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { font-size: 1.1rem; }
    .loading-sub { font-size: 0.9rem; margin-top: 8px; }
    
    .disclaimer { background: #21262d; border-radius: 8px; padding: 16px; margin-top: 20px; font-size: 0.85rem; color: #8b949e; }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div>
        <a href="analysis.html" class="back-link">â† è¿”å›åˆ†æä¸­å¿ƒ</a>
        <h1>ğŸ¤– AI ä¸‰å°ˆå®¶è¯åˆåˆ†æ</h1>
      </div>
      <div class="search-box">
        <input type="text" id="stockInput" placeholder="è‚¡ç¥¨ä»£ç¢¼" value="2330">
        <button class="btn" onclick="analyze()">ğŸ”® AI åˆ†æ</button>
      </div>
    </header>

    <div id="content">
      <div class="loading">
        <div class="spinner"></div>
        <div class="loading-text">è¼‰å…¥ä¸­...</div>
      </div>
    </div>
  </div>

  <script>
    async function analyze() {
      const stockId = document.getElementById('stockInput').value.trim();
      if (!stockId) return alert('è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼');
      
      document.getElementById('content').innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">ğŸ¤– ä¸‰ä½ AI å°ˆå®¶æ­£åœ¨æ·±åº¦åˆ†æ...</div>
          <div class="loading-sub">Claude (æŠ€è¡“æ´¾) + Gemini (ç±Œç¢¼æ´¾) + GPT (è¶¨å‹¢æ´¾)</div>
        </div>
      `;
      
      try {
        const stockRes = await fetch(`/api/line/wave/analyze/${stockId}`);
        const stockData = await stockRes.json();
        if (stockData.error) throw new Error(stockData.error);
        
        // è¨ˆç®—æŠ€è¡“æŒ‡æ¨™
        const indicators = calculateIndicators(stockData);
        const aiData = generateDetailedAIAnalysis(stockData, indicators);
        
        renderAnalysis(stockId, stockData, aiData, indicators);
      } catch (e) {
        document.getElementById('content').innerHTML = `<div class="summary-card"><p style="color:#f85149;">åˆ†æå¤±æ•—: ${e.message}</p></div>`;
      }
    }
    
    function calculateIndicators(stockData) {
      const { history, currentPrice, currentWave } = stockData;
      const prices = history.map(h => h.close);
      const len = prices.length;
      
      // MA è¨ˆç®—
      const ma5 = prices.slice(-5).reduce((a, b) => a + b, 0) / 5;
      const ma10 = prices.slice(-10).reduce((a, b) => a + b, 0) / Math.min(10, len);
      const ma20 = prices.slice(-20).reduce((a, b) => a + b, 0) / Math.min(20, len);
      const ma60 = prices.slice(-60).reduce((a, b) => a + b, 0) / Math.min(60, len);
      
      // RSI è¨ˆç®—
      let gains = 0, losses = 0;
      for (let i = len - 14; i < len; i++) {
        const diff = prices[i] - prices[i - 1];
        if (diff > 0) gains += diff;
        else losses -= diff;
      }
      const rsi = 100 - (100 / (1 + (gains / 14) / (losses / 14 || 1)));
      
      // ä¹–é›¢ç‡
      const bias5 = ((currentPrice - ma5) / ma5 * 100);
      const bias20 = ((currentPrice - ma20) / ma20 * 100);
      
      // æˆäº¤é‡åˆ†æ
      const volumes = history.slice(-20).map(h => h.volume || 0);
      const avgVolume = volumes.reduce((a, b) => a + b, 0) / volumes.length;
      const lastVolume = volumes[volumes.length - 1] || 0;
      const volumeRatio = lastVolume / avgVolume;
      
      // æ³¢æ®µé«˜ä½é»
      const high52 = Math.max(...prices.slice(-252));
      const low52 = Math.min(...prices.slice(-252));
      const pricePosition = (currentPrice - low52) / (high52 - low52) * 100;
      
      return { ma5, ma10, ma20, ma60, rsi, bias5, bias20, avgVolume, volumeRatio, high52, low52, pricePosition };
    }
    
    function generateDetailedAIAnalysis(stockData, ind) {
      const { currentPrice, changePercent, currentWave, stockName } = stockData;
      const isUpTrend = [1, 2, 3, '1', '2', '3'].includes(currentWave);
      const isDownTrend = ['A', 'B', 'C', 'a', 'b', 'c'].includes(currentWave);
      const isWave5 = [5, '5'].includes(currentWave);
      
      const maAlignment = ind.ma5 > ind.ma10 && ind.ma10 > ind.ma20 ? 'å¤šé ­æ’åˆ—' : 
                         ind.ma5 < ind.ma10 && ind.ma10 < ind.ma20 ? 'ç©ºé ­æ’åˆ—' : 'ç³¾çµæ•´ç†';
      
      // Claude - æŠ€è¡“åˆ†æå¸« (300+ å­—)
      const claudeDir = isUpTrend ? 'ä¸Šæ¼²' : (isDownTrend ? 'ä¸‹è·Œ' : 'ç›¤æ•´');
      const claudeConf = isUpTrend ? 78 : (isDownTrend ? 72 : 55);
      const claudeReason = `
        <p><strong>ã€æ³¢æµªçµæ§‹åˆ†æã€‘</strong>æ ¹æ“šè‰¾ç•¥ç‰¹æ³¢æµªç†è«–ï¼Œ${stockName}ç›®å‰è™•æ–¼ç¬¬${currentWave}æµªçš„ä½ç½®ã€‚${
          isUpTrend ? `é€™æ˜¯å…¸å‹çš„ä¸Šå‡è¶¨å‹¢çµæ§‹ï¼Œç¬¬${currentWave}æµªé€šå¸¸å…·æœ‰è¼ƒå¼·çš„æ¨å‹•åŠ›é“ã€‚å¾æ³¢æµªç†è«–çš„è§’åº¦ä¾†çœ‹ï¼Œç¬¬1æµªæ˜¯è¶¨å‹¢çš„èµ·å§‹ï¼Œç¬¬3æµªé€šå¸¸æ˜¯æœ€å¼·å‹¢çš„ä¸»å‡æ®µï¼Œè€Œç¬¬5æµªå‰‡æ˜¯ä¸Šå‡è¶¨å‹¢çš„æœ€å¾Œä¸€æ³¢ã€‚` :
          isDownTrend ? `é€™æ˜¯ä¿®æ­£æµªçš„çµæ§‹ï¼ŒAæµªé€šå¸¸æ˜¯æ€¥è·Œï¼ŒBæµªæ˜¯åå½ˆï¼ŒCæµªå‰‡æ˜¯æœ€å¾Œä¸€æ³¢æ®ºç›¤ã€‚ä¿®æ­£æµªçš„ç‰¹æ€§æ˜¯èµ°å‹¢è¼ƒç‚ºè¤‡é›œï¼Œå®¹æ˜“å‡ºç¾å‡çªç ´å’Œèª˜å¤šé™·é˜±ã€‚` :
          `ç›®å‰è™•æ–¼éæ¸¡éšæ®µï¼Œéœ€è¦ç­‰å¾…æ›´æ˜ç¢ºçš„æ–¹å‘çªç ´ä¿¡è™Ÿã€‚`
        }</p>
        
        <p><strong>ã€å‡ç·šç³»çµ±åˆ¤è®€ã€‘</strong>å¾å‡ç·šçš„è§’åº¦åˆ†æï¼Œç›®å‰MA5ç‚º${ind.ma5.toFixed(2)}å…ƒï¼ŒMA10ç‚º${ind.ma10.toFixed(2)}å…ƒï¼ŒMA20ç‚º${ind.ma20.toFixed(2)}å…ƒï¼ŒMA60ç‚º${ind.ma60.toFixed(2)}å…ƒã€‚å‡ç·šå‘ˆç¾ã€Œ${maAlignment}ã€çš„æ…‹å‹¢ã€‚${
          maAlignment === 'å¤šé ­æ’åˆ—' ? 'çŸ­æœŸå‡ç·šåœ¨ä¸Šã€é•·æœŸå‡ç·šåœ¨ä¸‹ï¼Œé€™æ˜¯æ¨™æº–çš„å¤šé ­å¸‚å ´ç‰¹å¾µï¼Œä»£è¡¨çŸ­ä¸­é•·æœŸæŠ•è³‡äººéƒ½è™•æ–¼ç²åˆ©ç‹€æ…‹ï¼Œè‚¡åƒ¹ä¸Šæ¼²çš„æ©Ÿç‡è¼ƒé«˜ã€‚' :
          maAlignment === 'ç©ºé ­æ’åˆ—' ? 'çŸ­æœŸå‡ç·šåœ¨ä¸‹ã€é•·æœŸå‡ç·šåœ¨ä¸Šï¼Œé€™æ˜¯ç©ºé ­å¸‚å ´çš„ç‰¹å¾µï¼Œæ„å‘³è‘—è¿‘æœŸè²·é€²çš„æŠ•è³‡äººå¤§å¤šè™•æ–¼å¥—ç‰¢ç‹€æ…‹ï¼Œè³£å£“è¼ƒé‡ã€‚' :
          'å‡ç·šç³¾çµé€šå¸¸ä»£è¡¨å¤šç©ºå‹¢åŠ›æ‹‰é‹¸ï¼Œå³å°‡é¸æ“‡æ–¹å‘çªç ´ï¼Œæ­¤æ™‚æ‡‰ç­‰å¾…æ˜ç¢ºè¨Šè™Ÿå†è¡Œå‹•ã€‚'
        }</p>
        
        <p><strong>ã€æŠ€è¡“æŒ‡æ¨™ç ”åˆ¤ã€‘</strong>RSIæŒ‡æ¨™ç›®å‰ç‚º${ind.rsi.toFixed(1)}ï¼Œ${
          ind.rsi > 70 ? 'å·²é€²å…¥è¶…è²·å€é–“ï¼ŒçŸ­ç·šæœ‰éç†±è·¡è±¡ï¼Œéœ€ç•™æ„æ‹‰å›é¢¨éšªã€‚ä½†åœ¨å¼·å‹¢è‚¡ä¸­ï¼ŒRSIå¯èƒ½åœ¨è¶…è²·å€ç¶­æŒä¸€æ®µæ™‚é–“ã€‚' :
          ind.rsi < 30 ? 'è™•æ–¼è¶…è³£å€é–“ï¼ŒçŸ­ç·šå¯èƒ½æœ‰åå½ˆéœ€æ±‚ã€‚ä½†è‹¥åŸºæœ¬é¢è½‰å·®ï¼Œä½æª”å¯èƒ½é‚„æœ‰æ›´ä½ã€‚' :
          'è™•æ–¼ä¸­æ€§å€é–“ï¼Œå¤šç©ºçš†æœ‰å¯èƒ½ï¼Œéœ€æ­é…å…¶ä»–æŒ‡æ¨™åˆ¤æ–·ã€‚'
        }5æ—¥ä¹–é›¢ç‡ç‚º${ind.bias5.toFixed(2)}%ï¼Œ20æ—¥ä¹–é›¢ç‡ç‚º${ind.bias20.toFixed(2)}%ï¼Œ${
          ind.bias20 > 10 ? 'ä¹–é›¢éå¤§ï¼ŒçŸ­ç·šæœ‰ä¿®æ­£å£“åŠ›ã€‚' :
          ind.bias20 < -10 ? 'è² ä¹–é›¢éå¤§ï¼Œå¯èƒ½å‡ºç¾æŠ€è¡“æ€§åå½ˆã€‚' :
          'ä¹–é›¢ç‡åœ¨åˆç†ç¯„åœå…§ã€‚'
        }</p>
        
        <p><strong>ã€æ“ä½œå»ºè­°ã€‘</strong>${
          claudeDir === 'ä¸Šæ¼²' ? `å»ºè­°å¯æ¡å–ã€Œé †å‹¢æ“ä½œã€ç­–ç•¥ï¼Œåœ¨è‚¡åƒ¹å›æ¸¬MA5æˆ–MA10æ™‚åˆ†æ‰¹å¸ƒå±€ï¼Œåœæé»å¯è¨­åœ¨MA20ä¸‹æ–¹ç´„3%çš„ä½ç½®ã€‚ä¸Šæ–¹å£“åŠ›ä½ç´„åœ¨${(currentPrice * 1.08).toFixed(0)}å…ƒé™„è¿‘ï¼Œè‹¥èƒ½çªç ´å‰‡æœ‰æ©ŸæœƒæŒ‘æˆ°å‰é«˜ã€‚` :
          claudeDir === 'ä¸‹è·Œ' ? `å»ºè­°æ¡å–ã€Œä¿å®ˆè§€æœ›ã€ç­–ç•¥ï¼ŒæŒè‚¡è€…å¯è€ƒæ…®åœ¨åå½ˆæ™‚æ¸›ç¢¼ï¼Œç©ºæ‰‹è€…ä¸å®œè²¿ç„¶æ¶åå½ˆã€‚ä¸‹æ–¹æ”¯æ’ä½ç´„åœ¨${(currentPrice * 0.92).toFixed(0)}å…ƒé™„è¿‘ï¼Œè‹¥è·Œç ´å‰‡å¯èƒ½é€²ä¸€æ­¥æ¸¬è©¦æ›´ä½æ”¯æ’ã€‚` :
          `å»ºè­°æ¡å–ã€Œå€é–“æ“ä½œã€ç­–ç•¥ï¼Œåœ¨æ”¯æ’ä½é™„è¿‘ä½æ¥ï¼Œå£“åŠ›ä½é™„è¿‘é«˜å‡ºã€‚æ”¯æ’å€é–“ç´„${(currentPrice * 0.95).toFixed(0)}~${(currentPrice * 0.97).toFixed(0)}å…ƒï¼Œå£“åŠ›å€é–“ç´„${(currentPrice * 1.03).toFixed(0)}~${(currentPrice * 1.05).toFixed(0)}å…ƒã€‚`
        }</p>
      `;
      
      // Gemini - ç±Œç¢¼åˆ†æå¸« (300+ å­—)
      const geminiDir = ind.volumeRatio > 1.2 && changePercent > 0 ? 'ä¸Šæ¼²' : 
                       ind.volumeRatio > 1.2 && changePercent < 0 ? 'ä¸‹è·Œ' : 'ç›¤æ•´';
      const geminiConf = ind.volumeRatio > 1.5 ? 75 : (ind.volumeRatio > 1 ? 65 : 55);
      const geminiReason = `
        <p><strong>ã€æˆäº¤é‡åˆ†æã€‘</strong>è¿‘20æ—¥å¹³å‡æˆäº¤é‡ç‚º${(ind.avgVolume/1000).toFixed(0)}å¼µï¼Œæœ€è¿‘ä¸€æ—¥æˆäº¤é‡ç‚º${((ind.avgVolume * ind.volumeRatio)/1000).toFixed(0)}å¼µï¼Œé‡èƒ½æ¯”ç‚º${(ind.volumeRatio * 100).toFixed(0)}%ã€‚${
          ind.volumeRatio > 1.5 ? 'æˆäº¤é‡æ˜é¡¯æ”¾å¤§ï¼Œé¡¯ç¤ºå¸‚å ´é—œæ³¨åº¦æå‡ï¼Œå¯èƒ½æœ‰ä¸»åŠ›è³‡é‡‘ä»‹å…¥æˆ–é‡è¦æ¶ˆæ¯é¢å½±éŸ¿ã€‚æ”¾é‡ä¸Šæ¼²æ˜¯å¥åº·çš„å¤šé ­è¨Šè™Ÿï¼Œæ”¾é‡ä¸‹è·Œå‰‡éœ€è­¦æƒ•è³£å£“ã€‚' :
          ind.volumeRatio > 1 ? 'æˆäº¤é‡æº«å’Œæ”¾å¤§ï¼Œå¸‚å ´äº¤æŠ•è¶¨æ–¼æ´»çµ¡ï¼Œè²·è³£é›™æ–¹åƒèˆ‡æ„é¡˜æå‡ï¼Œé€™æ˜¯è‚¡åƒ¹å¯èƒ½å‡ºç¾æ–¹å‘çš„å‰å…†ã€‚' :
          ind.volumeRatio < 0.7 ? 'æˆäº¤é‡æ˜é¡¯èç¸®ï¼Œå¸‚å ´è§€æœ›æ°£æ°›æ¿ƒåšï¼Œé€™ç¨®ä½é‡ç‹€æ…‹é€šå¸¸ä¸æœƒæŒçºŒå¤ªä¹…ï¼Œå¾ŒçºŒå¯èƒ½å‡ºç¾è®Šç›¤ã€‚' :
          'æˆäº¤é‡ç¶­æŒåœ¨å¹³å‡æ°´æº–ï¼Œå¸‚å ´äº¤æŠ•æ­£å¸¸ï¼Œæ²’æœ‰æ˜é¡¯çš„è³‡é‡‘é€²å‡ºè·¡è±¡ã€‚'
        }</p>
        
        <p><strong>ã€æ³•äººå‹•å‘è¿½è¹¤ã€‘</strong>å¾ç±Œç¢¼é¢è§€å¯Ÿï¼Œè¿‘æœŸæ³•äººè²·è³£è¶…æƒ…æ³å°è‚¡åƒ¹æœ‰é‡è¦å½±éŸ¿ã€‚${
          changePercent > 1 ? 'è‚¡åƒ¹ä¸Šæ¼²é…åˆæˆäº¤é‡å¢åŠ ï¼Œç ”åˆ¤å¤–è³‡èˆ‡æŠ•ä¿¡å¯èƒ½åŒæ­¥è²·è¶…ï¼Œç±Œç¢¼æœ‰å‘ç‰¹å®šäººé›†ä¸­çš„è·¡è±¡ã€‚ç•¶ç±Œç¢¼é›†ä¸­åº¦æå‡ï¼Œä»£è¡¨ä¸»åŠ›æ§ç›¤ç¨‹åº¦å¢åŠ ï¼Œæœ‰åˆ©æ–¼å¾ŒçºŒè‚¡åƒ¹è¡¨ç¾ã€‚' :
          changePercent < -1 ? 'è‚¡åƒ¹ä¸‹è·Œä¼´éš¨æˆäº¤é‡å¢åŠ ï¼Œå¯èƒ½å‡ºç¾æ³•äººèª¿ç¯€è³£è¶…çš„æƒ…æ³ã€‚è‹¥é€£çºŒå¤šæ—¥è³£è¶…ï¼Œéœ€é—œæ³¨ç±Œç¢¼é¬†å‹•çš„é¢¨éšªï¼Œé€™å¯èƒ½å°è‡´è‚¡åƒ¹æŒçºŒèµ°å¼±ã€‚' :
          'æ³•äººé€²å‡ºç›¸å°å¹³ç©©ï¼Œæ²’æœ‰æ˜é¡¯çš„å–®é‚Šæ“ä½œï¼Œé¡¯ç¤ºæ©Ÿæ§‹æŠ•è³‡äººå°ç›®å‰åƒ¹ä½æ¡å–è§€æœ›æ…‹åº¦ï¼Œç­‰å¾…æ›´å¥½çš„é€²å ´æˆ–å‡ºå ´æ™‚æ©Ÿã€‚'
        }å»ºè­°æŒçºŒè¿½è¹¤ä¸‰å¤§æ³•äººï¼ˆå¤–è³‡ã€æŠ•ä¿¡ã€è‡ªç‡Ÿå•†ï¼‰çš„è²·è³£è¶…è®ŠåŒ–ï¼Œä½œç‚ºé€²å‡ºå ´çš„é‡è¦åƒè€ƒä¾æ“šã€‚</p>
        
        <p><strong>ã€ä¸»åŠ›æˆæœ¬åˆ†æã€‘</strong>æ ¹æ“šè¿‘æœŸç±Œç¢¼åˆ†å¸ƒæ¨ä¼°ï¼Œä¸»åŠ›å¹³å‡æˆæœ¬å€é–“ç´„åœ¨${(currentPrice * 0.95).toFixed(0)}~${(currentPrice * 1.02).toFixed(0)}å…ƒä¹‹é–“ã€‚${
          currentPrice > currentPrice * 0.98 ? 'ç›®å‰è‚¡åƒ¹é«˜æ–¼ä¸»åŠ›æˆæœ¬ï¼Œä¸»åŠ›è™•æ–¼ç²åˆ©ç‹€æ…‹ï¼ŒçŸ­ç·šæœ‰è­·ç›¤å‹•æ©Ÿï¼Œä½†ä¹Ÿå¯èƒ½é€¢é«˜èª¿ç¯€ã€‚' :
          'ç›®å‰è‚¡åƒ¹æ¥è¿‘æˆ–ä½æ–¼ä¸»åŠ›æˆæœ¬ï¼Œä¸»åŠ›å¯èƒ½é€²è¡Œè£œè²¨æˆ–èªè³ å‡ºå ´ï¼Œéœ€å¯†åˆ‡è§€å¯Ÿå¾ŒçºŒé‡åƒ¹è®ŠåŒ–åˆ¤æ–·ä¸»åŠ›æ„åœ–ã€‚'
        }åˆ¸å•†åˆ†é»é€²å‡ºæ–¹é¢ï¼Œå»ºè­°é—œæ³¨å‰15å¤§åˆ¸å•†çš„è²·è³£è¶…æƒ…æ³ï¼Œé€™äº›é€šå¸¸æ˜¯ä¸»åŠ›è³‡é‡‘çš„ä¸»è¦é€²å‡ºç®¡é“ã€‚</p>
        
        <p><strong>ã€ç±Œç¢¼é¢çµè«–ã€‘</strong>${
          geminiDir === 'ä¸Šæ¼²' ? `ç±Œç¢¼é¢å‘ˆç¾æ­£å‘è¨Šè™Ÿï¼Œæˆäº¤é‡é…åˆåƒ¹æ ¼ä¸Šæ¼²ï¼Œæ³•äººæŒè‚¡å¯èƒ½å¢åŠ ã€‚å»ºè­°å¯åœ¨é‡ç¸®å›æª”æ™‚ä½æ¥ï¼Œè¨­å®šåœæåœ¨è¿‘æœŸä½é»ä¸‹æ–¹ã€‚è‹¥å‡ºç¾çˆ†å¤§é‡é•·é»‘ï¼Œå‰‡éœ€é‡æ–°è©•ä¼°ã€‚` :
          geminiDir === 'ä¸‹è·Œ' ? `ç±Œç¢¼é¢å‡ºç¾è­¦è¨Šï¼Œæˆäº¤é‡æ”¾å¤§ä½†åƒ¹æ ¼ä¸‹è·Œï¼Œå¯èƒ½æœ‰ä¸»åŠ›å‡ºè²¨è·¡è±¡ã€‚å»ºè­°æ¸›ç¢¼è§€æœ›ï¼Œç­‰å¾…ç±Œç¢¼æ²‰æ¾±å¾Œå†è©•ä¼°é€²å ´æ™‚æ©Ÿã€‚` :
          `ç±Œç¢¼é¢æš«ç„¡æ˜ç¢ºæ–¹å‘ï¼Œå»ºè­°ç­‰å¾…é‡åƒ¹é…åˆçš„æ˜ç¢ºè¨Šè™Ÿå‡ºç¾å†è¡Œå‹•ã€‚å¯å…ˆå»ºç«‹è§€å¯Ÿåå–®ï¼Œè¨­å®šåƒ¹é‡çªç ´æ¢ä»¶ä½œç‚ºé€²å ´ä¾æ“šã€‚`
        }</p>
      `;
      
      // GPT - è¶¨å‹¢åˆ†æå¸« (300+ å­—)
      const gptDir = ind.pricePosition > 60 && maAlignment === 'å¤šé ­æ’åˆ—' ? 'ä¸Šæ¼²' :
                    ind.pricePosition < 40 && maAlignment === 'ç©ºé ­æ’åˆ—' ? 'ä¸‹è·Œ' : 'ç›¤æ•´';
      const gptConf = gptDir === 'ä¸Šæ¼²' ? 76 : (gptDir === 'ä¸‹è·Œ' ? 70 : 58);
      const gptReason = `
        <p><strong>ã€è¶¨å‹¢æ–¹å‘åˆ¤å®šã€‘</strong>${stockName}ç›®å‰è‚¡åƒ¹${currentPrice.toFixed(2)}å…ƒï¼Œä½æ–¼52é€±é«˜é»${ind.high52.toFixed(2)}å…ƒèˆ‡ä½é»${ind.low52.toFixed(2)}å…ƒä¹‹é–“çš„${ind.pricePosition.toFixed(0)}%ä½ç½®ã€‚${
          ind.pricePosition > 80 ? 'è‚¡åƒ¹å·²æ¥è¿‘å¹´åº¦é«˜é»ï¼Œè™•æ–¼ç›¸å°é«˜æª”å€ï¼Œé€šå¸¸ä»£è¡¨è©²è‚¡è¿‘æœŸè¡¨ç¾å¼·å‹¢ï¼Œä½†ä¹Ÿæ„å‘³è‘—è¿½é«˜é¢¨éšªå¢åŠ ã€‚' :
          ind.pricePosition > 60 ? 'è‚¡åƒ¹ä½æ–¼ä¸­é«˜æª”å€ï¼Œæ•´é«”è¶¨å‹¢åå¤šï¼Œè‹¥èƒ½ç¶­æŒåœ¨æ­¤å€é–“æ•´ç†å¾Œå†åº¦çªç ´ï¼Œå‰‡ä¸Šæ¼²ç©ºé–“å¯æœŸã€‚' :
          ind.pricePosition > 40 ? 'è‚¡åƒ¹ä½æ–¼ä¸­é–“å€åŸŸï¼Œå¤šç©ºå‹¢åŠ›ç›¸ç•¶ï¼Œæ–¹å‘ä¸æ˜ç¢ºï¼Œå±¬æ–¼ç›¤æ•´æ ¼å±€ã€‚' :
          ind.pricePosition > 20 ? 'è‚¡åƒ¹ä½æ–¼ä¸­ä½æª”å€ï¼Œå¯èƒ½è™•æ–¼ç¯‰åº•éšæ®µï¼Œè‹¥åŸºæœ¬é¢ç„¡è™ï¼Œå¯è¦–ç‚ºæ½›åœ¨çš„ä½æ¥æ©Ÿæœƒã€‚' :
          'è‚¡åƒ¹æ¥è¿‘å¹´åº¦ä½é»ï¼Œé¢¨éšªèˆ‡æ©Ÿæœƒä¸¦å­˜ã€‚è‹¥æ˜¯ææ…Œæ€§æ®ºç›¤å¯èƒ½æ˜¯æ©Ÿæœƒï¼Œè‹¥æ˜¯åŸºæœ¬é¢æƒ¡åŒ–å‰‡æ‡‰è¿´é¿ã€‚'
        }</p>
        
        <p><strong>ã€ç”¢æ¥­è¶¨å‹¢å±•æœ›ã€‘</strong>å¾ç”¢æ¥­é¢ä¾†çœ‹ï¼Œ${
          stockName.includes('é›»') || stockName.includes('ç§‘') || stockName.includes('åŠå°') ? 'ç§‘æŠ€é¡è‚¡è¿‘æœŸå—åˆ°AIã€åŠå°é«”ã€é›»å‹•è»Šç­‰è­°é¡Œå¸¶å‹•ï¼Œæ•´é«”ç”¢æ¥­å‰æ™¯ä»ç„¶æ¨‚è§€ã€‚ç„¶è€Œï¼Œç§‘æŠ€è‚¡æ³¢å‹•è¼ƒå¤§ï¼Œéœ€æ³¨æ„åœ‹éš›å±€å‹¢ã€åŒ¯ç‡è®Šå‹•åŠä¾›æ‡‰éˆè®ŠåŒ–å°ç‡Ÿé‹çš„å½±éŸ¿ã€‚' :
          stockName.includes('é‡‘') || stockName.includes('éŠ€') ? 'é‡‘èé¡è‚¡å—ç›Šæ–¼å‡æ¯å¾ªç’°ï¼Œåˆ©å·®æ“´å¤§æœ‰åˆ©ç²åˆ©ï¼Œä½†éœ€é—œæ³¨æ™¯æ°£å¾ªç’°åŠä¿¡ç”¨é¢¨éšªã€‚é‡‘èè‚¡è‚¡æ€§ç©©å¥ï¼Œé©åˆå­˜è‚¡æ—é•·æœŸé…ç½®ã€‚' :
          stockName.includes('èˆª') || stockName.includes('é‹') ? 'èˆªé‹é¡è‚¡å—åˆ°å…¨çƒè²¿æ˜“åŠé‹åƒ¹æ³¢å‹•å½±éŸ¿è¼ƒå¤§ï¼Œè¿‘æœŸé‹åƒ¹èµ°å‹¢å°‡æ˜¯é—œéµè§€å¯ŸæŒ‡æ¨™ã€‚å»ºè­°å¯†åˆ‡é—œæ³¨BDIæŒ‡æ•¸åŠå„èˆªç·šé‹åƒ¹å ±åƒ¹ã€‚' :
          'è©²ç”¢æ¥­æ•´é«”è¶¨å‹¢éœ€ç¶œåˆè€ƒé‡ç¸½é«”ç¶“æ¿Ÿç’°å¢ƒã€ç”¢æ¥­ä¾›éœ€ã€å…¬å¸ç«¶çˆ­åŠ›ç­‰å› ç´ ã€‚å»ºè­°è¿½è¹¤è©²å…¬å¸æœˆç‡Ÿæ”¶ã€æ³•èªªæœƒè¨Šæ¯åŠç”¢æ¥­æ–°èï¼Œä»¥æŒæ¡æœ€æ–°å‹•æ…‹ã€‚'
        }</p>
        
        <p><strong>ã€ç¸½é«”ç’°å¢ƒè©•ä¼°ã€‘</strong>ç›®å‰å…¨çƒç¸½é«”ç¶“æ¿Ÿç’°å¢ƒæ–¹é¢ï¼Œ${
          ind.rsi > 50 ? 'å¸‚å ´é¢¨éšªåå¥½æå‡ï¼Œè³‡é‡‘æµå‘é¢¨éšªæ€§è³‡ç”¢ï¼Œæœ‰åˆ©æ–¼è‚¡å¸‚è¡¨ç¾ã€‚ä½†éœ€ç•™æ„é€šè†¨æ•¸æ“šã€å¤®è¡Œæ”¿ç­–å‹•å‘å°å¸‚å ´æƒ…ç·’çš„å½±éŸ¿ã€‚' :
          'å¸‚å ´æ°›åœè¶¨æ–¼ä¿å®ˆï¼Œè³‡é‡‘å‚¾å‘é˜²ç¦¦æ€§é…ç½®ã€‚åœ¨é€™ç¨®ç’°å¢ƒä¸‹ï¼Œé¸è‚¡é‡æ–¼é¸å¸‚ï¼Œæ‡‰èšç„¦æ–¼åŸºæœ¬é¢ç©©å¥ã€æ®–åˆ©ç‡å…·å¸å¼•åŠ›çš„æ¨™çš„ã€‚'
        }å°è‚¡æ–¹é¢ï¼Œå¤–è³‡å‹•å‘ã€å°å¹£åŒ¯ç‡ã€åŠå…©å²¸é—œä¿‚éƒ½æ˜¯å½±éŸ¿å¤§ç›¤èµ°å‹¢çš„é‡è¦è®Šæ•¸ã€‚</p>
        
        <p><strong>ã€è¶¨å‹¢æ“ä½œå»ºè­°ã€‘</strong>${
          gptDir === 'ä¸Šæ¼²' ? `å¾è¶¨å‹¢é¢ä¾†çœ‹ï¼Œå»ºè­°æ¡å–ã€Œé †å‹¢è€Œç‚ºã€ç­–ç•¥ã€‚çŸ­ç·šæ”¯æ’ç´„åœ¨${(currentPrice * 0.96).toFixed(0)}å…ƒï¼ˆ10æ—¥ç·šé™„è¿‘ï¼‰ï¼Œä¸­ç·šæ”¯æ’ç´„åœ¨${(currentPrice * 0.92).toFixed(0)}å…ƒï¼ˆæœˆç·šé™„è¿‘ï¼‰ã€‚åªè¦è‚¡åƒ¹ç¶­æŒåœ¨é€™äº›æ”¯æ’ä¹‹ä¸Šï¼Œå¯æŒçºŒçœ‹å¤šã€‚ç›®æ¨™åƒ¹å¯å…ˆçœ‹${(currentPrice * 1.1).toFixed(0)}å…ƒï¼Œè‹¥çªç ´å‰é«˜å‰‡ä¸Šçœ‹${(currentPrice * 1.15).toFixed(0)}å…ƒã€‚å»ºè­°åˆ†æ‰¹å¸ƒå±€ï¼Œä¸å®œå–®ç­†é‡æŠ¼ã€‚` :
          gptDir === 'ä¸‹è·Œ' ? `è¶¨å‹¢é¢åç©ºï¼Œå»ºè­°ã€Œæ¸›ç¢¼è§€æœ›ã€æˆ–ã€Œé€¢é«˜èª¿ç¯€ã€ã€‚çŸ­ç·šå£“åŠ›ç´„åœ¨${(currentPrice * 1.03).toFixed(0)}å…ƒï¼Œè‹¥åå½ˆç„¡æ³•çªç ´æ­¤å£“åŠ›ï¼Œå‰‡å¼±å‹¢æ ¼å±€ä¸è®Šã€‚ä¸‹æ–¹ç¬¬ä¸€é“æ”¯æ’åœ¨${(currentPrice * 0.95).toFixed(0)}å…ƒï¼Œè‹¥è·Œç ´å‰‡ä¸‹çœ‹${(currentPrice * 0.9).toFixed(0)}å…ƒã€‚ç©ºæ‰‹è€…ä¸å®œæ¶åå½ˆï¼ŒæŒè‚¡è€…å¯è¨­ç§»å‹•åœæä¿è­·ç²åˆ©ã€‚` :
          `è¶¨å‹¢é¢è™•æ–¼ç›¤æ•´éšæ®µï¼Œå»ºè­°ã€Œå€é–“æ“ä½œã€æˆ–ã€Œè§€æœ›ç­‰å¾…ã€ã€‚ä¸Šæ–¹å£“åŠ›${(currentPrice * 1.05).toFixed(0)}å…ƒï¼Œä¸‹æ–¹æ”¯æ’${(currentPrice * 0.95).toFixed(0)}å…ƒã€‚å¯åœ¨æ”¯æ’å€é™„è¿‘ä½æ¥ï¼Œå£“åŠ›å€é™„è¿‘é«˜å‡ºï¼Œæˆ–ç­‰å¾…æ–¹å‘æ˜ç¢ºçªç ´å¾Œå†é †å‹¢æ“ä½œã€‚è€å¿ƒæ˜¯æ­¤éšæ®µæœ€é‡è¦çš„ç´ è³ªã€‚`
        }</p>
      `;
      
      return {
        claude: { direction: claudeDir, confidence: claudeConf, reason: claudeReason },
        gemini: { direction: geminiDir, confidence: geminiConf, reason: geminiReason },
        gpt: { direction: gptDir, confidence: gptConf, reason: gptReason }
      };
    }
    
    function renderAnalysis(stockId, stockData, aiData, ind) {
      const { currentPrice, stockName, changePercent, currentWave } = stockData;
      const isUp = changePercent >= 0;
      
      const votes = { 'ä¸Šæ¼²': 0, 'ä¸‹è·Œ': 0, 'ç›¤æ•´': 0 };
      [aiData.claude, aiData.gemini, aiData.gpt].forEach(ai => { votes[ai.direction]++; });
      
      const finalDirection = Object.entries(votes).sort((a, b) => b[1] - a[1])[0][0];
      const avgConfidence = Math.round((aiData.claude.confidence + aiData.gemini.confidence + aiData.gpt.confidence) / 3);
      const dirClass = finalDirection === 'ä¸Šæ¼²' ? 'up' : (finalDirection === 'ä¸‹è·Œ' ? 'down' : 'neutral');
      
      document.getElementById('content').innerHTML = `
        <div class="stock-info">
          <div class="name">${stockName} (${stockId})</div>
          <div class="price">$${currentPrice.toFixed(2)}</div>
          <div class="change ${isUp ? 'up' : 'down'}">${isUp ? 'â–²' : 'â–¼'} ${Math.abs(changePercent).toFixed(2)}%</div>
          <div class="wave">ğŸŒŠ ç›®å‰æ³¢æµªä½ç½®ï¼šç¬¬ ${currentWave} æµª</div>
        </div>
        
        <div class="summary-card">
          <div class="summary-header">
            <h2>ğŸ¯ ä¸‰ AI ç¶œåˆç ”åˆ¤</h2>
            <div class="final-direction ${dirClass}">${finalDirection === 'ä¸Šæ¼²' ? 'ğŸ“ˆ çœ‹å¤š' : finalDirection === 'ä¸‹è·Œ' ? 'ğŸ“‰ çœ‹ç©º' : 'ğŸ“Š è§€æœ›'}</div>
          </div>
          <div class="summary-content">
            <p>ç¶“éä¸‰ä½ AI å°ˆå®¶å¾æŠ€è¡“é¢ã€ç±Œç¢¼é¢ã€è¶¨å‹¢é¢çš„å…¨æ–¹ä½åˆ†æï¼Œå°æ–¼ <strong>${stockName}</strong> çš„ç¶œåˆæŠ•è³‡å»ºè­°ç‚ºï¼š<strong style="color:${dirClass === 'up' ? '#f85149' : dirClass === 'down' ? '#3fb950' : '#8b949e'}; font-size:1.1rem;">${finalDirection}</strong>ã€‚</p>
            <p>ä¸‰ä½å°ˆå®¶çš„å¹³å‡ä¿¡å¿ƒåº¦ç‚º <strong>${avgConfidence}%</strong>ï¼Œ${avgConfidence >= 70 ? 'å…±è­˜åº¦è¼ƒé«˜ï¼Œå»ºè­°å¯ç©æ¥µé—œæ³¨ã€‚' : avgConfidence >= 55 ? 'æ„è¦‹ç•¥æœ‰åˆ†æ­§ï¼Œå»ºè­°è¬¹æ…æ“ä½œã€‚' : 'çœ‹æ³•è¼ƒç‚ºåˆ†æ•£ï¼Œå»ºè­°è§€æœ›ç‚ºä¸»ã€‚'}</p>
            <p>æŠ€è¡“æŒ‡æ¨™é€Ÿè¦½ï¼šRSI ${ind.rsi.toFixed(1)} | 5æ—¥ä¹–é›¢ ${ind.bias5.toFixed(2)}% | 20æ—¥ä¹–é›¢ ${ind.bias20.toFixed(2)}% | é‡æ¯” ${(ind.volumeRatio * 100).toFixed(0)}%</p>
          </div>
          <div class="vote-result">
            <div class="vote-item">ğŸ”´ çœ‹å¤šï¼š${votes['ä¸Šæ¼²']} ç¥¨</div>
            <div class="vote-item">ğŸŸ¢ çœ‹ç©ºï¼š${votes['ä¸‹è·Œ']} ç¥¨</div>
            <div class="vote-item">âšª è§€æœ›ï¼š${votes['ç›¤æ•´']} ç¥¨</div>
          </div>
        </div>
        
        <div class="ai-grid">
          ${renderAICard('claude', 'Claude', 'æŠ€è¡“åˆ†æå¸«', 'ğŸŸ£', aiData.claude)}
          ${renderAICard('gemini', 'Gemini', 'ç±Œç¢¼åˆ†æå¸«', 'ğŸ”µ', aiData.gemini)}
          ${renderAICard('openai', 'GPT', 'è¶¨å‹¢åˆ†æå¸«', 'ğŸŸ¢', aiData.gpt)}
        </div>
        
        <div class="disclaimer">
          âš ï¸ <strong>å…è²¬è²æ˜ï¼š</strong>ä»¥ä¸Šåˆ†æåƒ…ä¾›åƒè€ƒï¼Œä¸æ§‹æˆä»»ä½•æŠ•è³‡å»ºè­°ã€‚è‚¡å¸‚æŠ•è³‡æœ‰é¢¨éšªï¼Œéå»ç¸¾æ•ˆä¸ä»£è¡¨æœªä¾†è¡¨ç¾ã€‚æŠ•è³‡äººæ‡‰å¯©æ…è©•ä¼°è‡ªèº«é¢¨éšªæ‰¿å—èƒ½åŠ›ï¼Œä¸¦è‡ªè¡Œè² è²¬æŠ•è³‡æ±ºç­–ã€‚å»ºè­°è«®è©¢å°ˆæ¥­è²¡å‹™é¡§å•å¾Œå†è¡Œå‹•ã€‚
        </div>
      `;
    }
    
    function renderAICard(type, name, role, emoji, data) {
      const dirClass = data.direction === 'ä¸Šæ¼²' ? 'up' : (data.direction === 'ä¸‹è·Œ' ? 'down' : 'neutral');
      const confColor = data.confidence >= 70 ? '#3fb950' : data.confidence >= 50 ? '#d29922' : '#f85149';
      
      return `
        <div class="ai-card">
          <div class="ai-card-header ${type}">
            <div class="ai-avatar">${emoji}</div>
            <div class="ai-info">
              <div class="ai-name">${name}</div>
              <div class="ai-role">${role}</div>
            </div>
          </div>
          <div class="ai-card-body">
            <div class="ai-direction">
              <span>æŠ•è³‡åˆ¤æ–·ï¼š</span>
              <span class="direction-badge ${dirClass}">${data.direction === 'ä¸Šæ¼²' ? 'ğŸ“ˆ çœ‹å¤š' : data.direction === 'ä¸‹è·Œ' ? 'ğŸ“‰ çœ‹ç©º' : 'ğŸ“Š è§€æœ›'}</span>
            </div>
            <div class="ai-reason">${data.reason}</div>
            <div class="ai-confidence">
              <span style="color:#8b949e;">ä¿¡å¿ƒåº¦</span>
              <div class="confidence-bar">
                <div class="confidence-fill" style="width:${data.confidence}%; background:${confColor};"></div>
              </div>
              <span style="color:${confColor}; font-weight:700;">${data.confidence}%</span>
            </div>
          </div>
        </div>
      `;
    }
    
    const urlParams = new URLSearchParams(window.location.search);
    document.getElementById('stockInput').value = urlParams.get('stock') || '2330';
    analyze();
  </script>
</body>
</html>
