<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“‘ AI è²¡å ±åˆ†æ - è‚¡æµ·ç§˜æ›¸</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans TC', sans-serif; }
    body { background: #0d1117; min-height: 100vh; color: #e6edf3; }
    .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
    .header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background: #161b22; border-radius: 12px; margin-bottom: 20px; border: 1px solid #30363d; }
    .header h1 { font-size: 1.4rem; color: #a371f7; }
    .search-box { display: flex; gap: 10px; }
    .search-box input { padding: 10px 16px; border-radius: 8px; border: 1px solid #30363d; background: #0d1117; color: #e6edf3; width: 120px; }
    .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; background: #a371f7; color: white; }
    .back-link { color: #58a6ff; text-decoration: none; font-size: 0.9rem; }
    .stock-info { background: #161b22; border-radius: 12px; border: 1px solid #30363d; padding: 20px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
    .stock-info .name { font-size: 1.3rem; font-weight: 700; color: #c9d1d9; }
    .stock-info .price { font-size: 1.8rem; font-weight: 700; color: #58a6ff; }
    .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px; }
    .metric-card { background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 20px; }
    .metric-card .label { color: #8b949e; font-size: 0.85rem; margin-bottom: 8px; }
    .metric-card .value { font-size: 1.5rem; font-weight: 700; }
    .metric-card .change { font-size: 0.85rem; margin-top: 4px; }
    .main-card { background: #161b22; border-radius: 12px; border: 1px solid #30363d; padding: 20px; margin-bottom: 20px; }
    .card-title { color: #c9d1d9; margin-bottom: 16px; }
    .chart-container { height: 250px; }
    .ai-summary { background: linear-gradient(135deg, #a371f7, #8957e5); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
    .ai-summary h3 { color: white; margin-bottom: 12px; }
    .ai-summary p { color: rgba(255,255,255,0.9); line-height: 1.7; }
    .loading { text-align: center; padding: 60px; color: #8b949e; }
    .spinner { width: 40px; height: 40px; border: 3px solid #30363d; border-top-color: #a371f7; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div><a href="analysis.html" class="back-link">â† è¿”å›åˆ†æä¸­å¿ƒ</a><h1>ğŸ“‘ AI è²¡å ±åˆ†æ</h1></div>
      <div class="search-box">
        <input type="text" id="stockInput" placeholder="è‚¡ç¥¨ä»£ç¢¼" value="2330">
        <button class="btn" onclick="analyze()">ğŸ”® åˆ†æ</button>
      </div>
    </header>
    <div id="content"><div class="loading"><div class="spinner"></div><p>è¼‰å…¥ä¸­...</p></div></div>
  </div>
  <script>
    async function analyze() {
      const stockId = document.getElementById('stockInput').value.trim();
      if (!stockId) return alert('è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼');
      document.getElementById('content').innerHTML = '<div class="loading"><div class="spinner"></div><p>AI æ­£åœ¨åˆ†æè²¡å ±...</p></div>';
      try {
        const res = await fetch(`/api/line/wave/analyze/${stockId}`);
        const data = await res.json();
        if (data.error) throw new Error(data.error);
        renderAnalysis(stockId, data);
      } catch (e) {
        document.getElementById('content').innerHTML = `<div class="main-card"><p style="color:#f85149;">åˆ†æå¤±æ•—: ${e.message}</p></div>`;
      }
    }
    
    function renderAnalysis(stockId, data) {
      const { stockName, currentPrice, changePercent } = data;
      
      // æ¨¡æ“¬è²¡å‹™æ•¸æ“š
      const eps = (Math.random() * 20 + 5).toFixed(2);
      const pe = (currentPrice / eps).toFixed(1);
      const roe = (Math.random() * 15 + 10).toFixed(1);
      const revenue = Math.floor(Math.random() * 5000 + 1000);
      const revenueGrowth = (Math.random() * 30 - 5).toFixed(1);
      const profitMargin = (Math.random() * 30 + 10).toFixed(1);
      
      const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
      const epsData = quarters.map(() => Math.random() * 5 + 2);
      const revenueData = quarters.map(() => Math.random() * 1000 + 500);
      
      document.getElementById('content').innerHTML = `
        <div class="stock-info">
          <div><div class="name">${stockName} (${stockId})</div><div class="price">$${currentPrice.toFixed(2)}</div></div>
        </div>
        
        <div class="ai-summary">
          <h3>ğŸ¤– AI è²¡å ±æ‘˜è¦</h3>
          <p>æ ¹æ“šæœ€æ–°è²¡å ±åˆ†æï¼Œ${stockName} çš„ç²åˆ©èƒ½åŠ›${parseFloat(roe) > 15 ? 'å„ªç§€' : 'ç©©å¥'}ï¼ŒROE é” ${roe}%ã€‚æœ¬ç›Šæ¯” ${pe} å€${parseFloat(pe) < 15 ? 'ï¼Œä¼°å€¼åä½å…·æŠ•è³‡åƒ¹å€¼' : parseFloat(pe) > 25 ? 'ï¼Œä¼°å€¼åé«˜éœ€æ³¨æ„é¢¨éšª' : 'ï¼Œè™•æ–¼åˆç†å€é–“'}ã€‚ç‡Ÿæ”¶å¹´å¢ç‡ ${revenueGrowth}%ï¼Œ${parseFloat(revenueGrowth) > 10 ? 'æˆé•·å‹•èƒ½å¼·å‹' : parseFloat(revenueGrowth) > 0 ? 'ç¶­æŒç©©å®šæˆé•·' : 'é¢è‡¨æˆé•·å£“åŠ›'}ã€‚æ•´é«”è²¡å‹™é«”è³ª${parseFloat(roe) > 12 && parseFloat(profitMargin) > 15 ? 'å¥åº·' : 'å°šå¯'}ã€‚</p>
        </div>
        
        <div class="metric-grid">
          <div class="metric-card">
            <div class="label">æ¯è‚¡ç›ˆé¤˜ (EPS)</div>
            <div class="value" style="color:#58a6ff;">$${eps}</div>
          </div>
          <div class="metric-card">
            <div class="label">æœ¬ç›Šæ¯” (P/E)</div>
            <div class="value" style="color:${parseFloat(pe) < 15 ? '#3fb950' : parseFloat(pe) > 25 ? '#f85149' : '#d29922'};">${pe}x</div>
          </div>
          <div class="metric-card">
            <div class="label">è‚¡æ±æ¬Šç›Šå ±é…¬ç‡ (ROE)</div>
            <div class="value" style="color:${parseFloat(roe) > 15 ? '#3fb950' : '#d29922'};">${roe}%</div>
          </div>
          <div class="metric-card">
            <div class="label">ç‡Ÿæ”¶ (å„„)</div>
            <div class="value" style="color:#c9d1d9;">${revenue}</div>
            <div class="change" style="color:${parseFloat(revenueGrowth) >= 0 ? '#f85149' : '#3fb950'};">YoY ${revenueGrowth}%</div>
          </div>
          <div class="metric-card">
            <div class="label">æ¯›åˆ©ç‡</div>
            <div class="value" style="color:#a371f7;">${profitMargin}%</div>
          </div>
          <div class="metric-card">
            <div class="label">AI è©•åˆ†</div>
            <div class="value" style="color:#3fb950;">${Math.floor(Math.random() * 20 + 70)}</div>
          </div>
        </div>
        
        <div class="main-card">
          <div class="card-title">ğŸ“Š è¿‘å››å­£ EPS èµ°å‹¢</div>
          <div class="chart-container"><canvas id="epsChart"></canvas></div>
        </div>
      `;
      
      new Chart(document.getElementById('epsChart'), {
        type: 'bar',
        data: { labels: quarters, datasets: [{ data: epsData, backgroundColor: '#a371f788', borderColor: '#a371f7', borderWidth: 1 }] },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } },
          scales: { x: { grid: { color: '#21262d' }, ticks: { color: '#8b949e' } }, y: { grid: { color: '#21262d' }, ticks: { color: '#8b949e', callback: v => '$' + v.toFixed(1) } } }
        }
      });
    }
    
    const urlParams = new URLSearchParams(window.location.search);
    document.getElementById('stockInput').value = urlParams.get('stock') || '2330';
    analyze();
  </script>
</body>
</html>
