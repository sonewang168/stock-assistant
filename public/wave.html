<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒŠ è‰¾ç•¥ç‰¹æ³¢æµªç†è«–åˆ†æ - è‚¡æµ·ç§˜æ›¸</title>
  <!-- Chart.js å’Œæ’ä»¶ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans TC', sans-serif; }
    body { background: #0d1117; min-height: 100vh; color: #E2E8F0; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    
    /* Header */
    .header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px 24px; background: #161b22; border-radius: 12px;
      margin-bottom: 20px; border: 1px solid #30363d;
    }
    .header h1 { font-size: 1.4rem; display: flex; align-items: center; gap: 10px; }
    .header h1 span { color: #58a6ff; }
    .search-box { display: flex; gap: 10px; }
    .search-box input {
      padding: 10px 16px; border-radius: 8px; border: 1px solid #30363d;
      background: #0d1117; color: #E2E8F0; width: 120px; font-size: 1rem;
    }
    .search-box input:focus { outline: none; border-color: #58a6ff; }
    .btn {
      padding: 10px 20px; border-radius: 8px; border: none;
      font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.9rem;
    }
    .btn-primary { background: #238636; color: white; }
    .btn-primary:hover { background: #2ea043; }
    
    /* Tabs */
    .tabs { display: flex; gap: 4px; margin-bottom: 20px; background: #161b22; padding: 4px; border-radius: 8px; width: fit-content; }
    .tab {
      padding: 10px 20px; border-radius: 6px; background: transparent;
      color: #8b949e; cursor: pointer; font-weight: 500; transition: all 0.2s; border: none;
    }
    .tab.active { background: #238636; color: white; }
    .tab:hover:not(.active) { color: #c9d1d9; }
    
    /* Main Card */
    .main-card {
      background: #161b22; border-radius: 12px; border: 1px solid #30363d;
      overflow: hidden;
    }
    .card-header {
      padding: 16px 20px; background: #21262d; border-bottom: 1px solid #30363d;
      display: flex; justify-content: space-between; align-items: center;
    }
    .card-header h2 { font-size: 1.1rem; color: #c9d1d9; }
    .card-body { padding: 24px; }
    
    /* Wave Analysis Box */
    .wave-analysis-box {
      background: #0d1117; border: 1px solid #30363d; border-radius: 12px;
      padding: 24px; margin-bottom: 24px;
    }
    .wave-analysis-title {
      display: flex; align-items: center; gap: 8px; margin-bottom: 20px;
      font-size: 1rem; color: #c9d1d9;
    }
    
    /* Wave Circles */
    .wave-circles {
      display: flex; justify-content: center; gap: 8px; margin-bottom: 24px;
    }
    .wave-circle {
      width: 44px; height: 44px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 1rem; cursor: pointer;
      transition: all 0.2s; position: relative;
    }
    /* æ¨å‹•æµª 1,3,5 = ç¶ è‰² */
    .wave-circle.w1, .wave-circle.w3, .wave-circle.w5 { background: #238636; color: white; }
    /* ä¿®æ­£æµª 2,4 = è—è‰² */
    .wave-circle.w2, .wave-circle.w4 { background: #1f6feb; color: white; }
    /* A,C æµª = ç´…è‰² */
    .wave-circle.wA, .wave-circle.wC { background: #da3633; color: white; }
    /* B æµª = æ©˜è‰² */
    .wave-circle.wB { background: #d29922; color: white; }
    /* ç•¶å‰æ³¢æµª */
    .wave-circle.active {
      box-shadow: 0 0 0 3px #58a6ff;
      transform: scale(1.15);
    }
    
    /* Current Wave Display */
    .current-wave-display { text-align: center; margin-bottom: 16px; }
    .current-wave-display .label { color: #8b949e; font-size: 1rem; }
    .current-wave-display .wave-number {
      font-size: 2.5rem; font-weight: 700; color: #58a6ff; margin: 0 8px;
    }
    .current-wave-display .wave-label { font-size: 1.2rem; color: #c9d1d9; }
    
    /* Trend Info */
    .trend-info {
      display: flex; justify-content: center; align-items: center; gap: 16px;
      font-size: 0.95rem; color: #8b949e; flex-wrap: wrap;
    }
    .trend-info .up { color: #f85149; }
    .trend-info .down { color: #3fb950; }
    .trend-info .separator { color: #30363d; }
    .from-wave-badge {
      padding: 4px 10px; border-radius: 4px; font-size: 0.85rem; font-weight: 500;
    }
    .from-wave-badge.up { background: rgba(248, 81, 73, 0.15); color: #f85149; }
    .from-wave-badge.down { background: rgba(63, 185, 80, 0.15); color: #3fb950; }
    
    /* Three Columns */
    .three-columns {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 24px;
    }
    .column-card {
      background: #0d1117; border: 1px solid #30363d; border-radius: 10px; overflow: hidden;
    }
    .column-header {
      padding: 12px 16px; background: #21262d; border-bottom: 1px solid #30363d;
      font-size: 0.9rem; font-weight: 600; color: #c9d1d9;
    }
    .column-body { padding: 16px; }
    
    /* Rule Check */
    .rule-item {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 12px; margin-bottom: 8px;
      background: #161b22; border-radius: 6px;
      border-left: 3px solid;
    }
    .rule-item.pass { border-color: #3fb950; }
    .rule-item.fail { border-color: #f85149; }
    .rule-icon { font-size: 1.1rem; }
    .rule-text { font-size: 0.85rem; color: #c9d1d9; }
    
    /* Wave History */
    .wave-history-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 8px 12px; margin-bottom: 6px;
      background: #161b22; border-radius: 6px; font-size: 0.85rem;
    }
    .wave-history-item .wave-name { color: #c9d1d9; font-weight: 500; }
    .wave-history-item .wave-type { color: #8b949e; font-size: 0.75rem; }
    .wave-history-item .wave-price { font-weight: 600; }
    .wave-history-item .wave-price.up { color: #f85149; }
    .wave-history-item .wave-price.down { color: #3fb950; }
    .wave-history-item.current { background: rgba(88, 166, 255, 0.15); border: 1px solid rgba(88, 166, 255, 0.3); }
    
    /* Suggestion Box */
    .suggestion-box {
      background: rgba(35, 134, 54, 0.1); border: 1px solid rgba(35, 134, 54, 0.3);
      border-radius: 8px; padding: 14px; margin-bottom: 16px;
    }
    .suggestion-box p { color: #c9d1d9; font-size: 0.9rem; line-height: 1.5; }
    
    /* Targets */
    .targets-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .target-box { padding: 12px; border-radius: 8px; text-align: center; }
    .target-box.up { background: rgba(248, 81, 73, 0.1); border: 1px solid rgba(248, 81, 73, 0.3); }
    .target-box.down { background: rgba(63, 185, 80, 0.1); border: 1px solid rgba(63, 185, 80, 0.3); }
    .target-box .label { font-size: 0.75rem; color: #8b949e; margin-bottom: 4px; }
    .target-box .value { font-size: 1.2rem; font-weight: 700; }
    .target-box.up .value { color: #f85149; }
    .target-box.down .value { color: #3fb950; }
    
    /* Chart */
    .chart-section { margin-bottom: 24px; }
    .chart-container { height: 320px; position: relative; }
    .chart-legend {
      display: flex; gap: 16px; justify-content: center; margin-top: 10px; flex-wrap: wrap;
    }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: #8b949e; }
    .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
    
    /* Recent Data Table */
    .data-table { width: 100%; font-size: 0.8rem; border-collapse: collapse; }
    .data-table th { text-align: left; padding: 8px; color: #8b949e; border-bottom: 1px solid #30363d; }
    .data-table td { padding: 8px; border-bottom: 1px solid #21262d; }
    .data-table tr.up td { color: #f85149; }
    .data-table tr.down td { color: #3fb950; }
    
    /* Fibonacci */
    .fib-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 8px 12px; margin-bottom: 4px; border-radius: 6px;
      background: #161b22; border-left: 3px solid;
    }
    .fib-ratio { font-weight: 600; }
    .fib-price { color: #c9d1d9; }
    
    /* Portfolio Tab */
    .portfolio-controls {
      display: flex; gap: 12px; align-items: center; flex-wrap: wrap;
      padding: 16px; background: #0d1117; border-radius: 8px; margin-bottom: 20px;
    }
    .portfolio-controls input {
      padding: 8px 12px; border-radius: 6px; border: 1px solid #30363d;
      background: #161b22; color: #c9d1d9; font-size: 0.9rem;
    }
    .budget-btns { display: flex; gap: 6px; }
    .budget-btn {
      padding: 6px 12px; border-radius: 6px; border: 1px solid #30363d;
      background: transparent; color: #8b949e; cursor: pointer; font-size: 0.8rem;
    }
    .budget-btn:hover, .budget-btn.active { background: #238636; color: white; border-color: #238636; }
    
    /* Summary Grid */
    .summary-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 20px; }
    .summary-card {
      background: #0d1117; border: 1px solid #30363d; border-radius: 8px;
      padding: 14px; text-align: center;
    }
    .summary-card .label { color: #8b949e; font-size: 0.75rem; margin-bottom: 4px; }
    .summary-card .value { font-size: 1.1rem; font-weight: 700; }
    
    /* Stock List */
    .stock-header {
      display: grid; grid-template-columns: 130px 1fr 100px 70px 70px 50px;
      gap: 12px; padding: 10px 14px; color: #8b949e; font-size: 0.8rem; font-weight: 600;
    }
    .stock-item {
      display: grid; grid-template-columns: 130px 1fr 100px 70px 70px 50px;
      gap: 12px; align-items: center; padding: 12px 14px;
      background: #0d1117; border: 1px solid #30363d; border-radius: 8px; margin-bottom: 8px;
    }
    .stock-item:hover { border-color: #58a6ff; }
    .stock-item .name { font-weight: 600; color: #c9d1d9; }
    .stock-item .sector { font-size: 0.8rem; color: #8b949e; }
    .stock-item .amount { color: #3fb950; font-weight: 600; }
    .stock-item input {
      width: 55px; padding: 6px; border-radius: 4px; border: 1px solid #30363d;
      background: #161b22; color: #c9d1d9; text-align: center; font-size: 0.85rem;
    }
    .wave-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
    .delete-btn {
      background: rgba(248, 81, 73, 0.15); color: #f85149; border: none;
      padding: 6px 8px; border-radius: 4px; cursor: pointer; font-size: 0.85rem;
    }
    
    /* Add Form */
    .add-form {
      display: flex; gap: 8px; align-items: center; padding: 14px;
      background: rgba(35, 134, 54, 0.1); border: 1px solid rgba(35, 134, 54, 0.3);
      border-radius: 8px; margin-top: 12px;
    }
    .add-form input { flex: 1; min-width: 60px; }
    
    /* Risk Section */
    .risk-section { margin-top: 24px; padding: 20px; background: #0d1117; border: 1px solid #30363d; border-radius: 8px; }
    .risk-bar-bg {
      height: 12px; background: linear-gradient(90deg, #3fb950 0%, #d29922 50%, #f85149 100%);
      border-radius: 6px; position: relative; margin: 16px 0;
    }
    .risk-indicator {
      position: absolute; top: -6px; width: 24px; height: 24px;
      background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-size: 0.65rem; font-weight: 700; color: #0d1117; box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transform: translateX(-50%); transition: left 0.5s;
    }
    .risk-labels { display: flex; justify-content: space-between; font-size: 0.75rem; color: #8b949e; }
    .risk-comment { margin-top: 14px; padding: 12px; background: #161b22; border-radius: 6px; font-size: 0.85rem; color: #c9d1d9; line-height: 1.5; }
    
    /* Sector Bars */
    .sector-section { margin-top: 24px; }
    .sector-row { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .sector-row .name { width: 70px; font-size: 0.85rem; color: #8b949e; }
    .sector-row .bar-bg { flex: 1; height: 18px; background: #21262d; border-radius: 4px; overflow: hidden; }
    .sector-row .bar-fill {
      height: 100%; display: flex; align-items: center; justify-content: flex-end;
      padding-right: 8px; transition: width 0.5s;
    }
    .sector-row .bar-fill span { color: white; font-size: 0.7rem; font-weight: 600; }
    
    /* Responsive */
    @media (max-width: 1024px) {
      .three-columns { grid-template-columns: 1fr; }
      .summary-grid { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 768px) {
      .header { flex-direction: column; gap: 12px; }
      .stock-header, .stock-item { grid-template-columns: 1fr 1fr; }
      .summary-grid { grid-template-columns: repeat(2, 1fr); }
    }
    
    .hidden { display: none !important; }
    .loading { text-align: center; padding: 30px; color: #8b949e; }
    .spinner {
      width: 32px; height: 32px; border: 3px solid #30363d; border-top-color: #58a6ff;
      border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 12px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* ğŸ†• ç¸®æ”¾æ§åˆ¶æŒ‰éˆ• */
    .chart-controls {
      display: flex; align-items: center; gap: 8px; margin-bottom: 12px;
      padding: 8px 12px; background: #21262d; border-radius: 8px;
    }
    .zoom-btn {
      padding: 8px 14px; border-radius: 6px; border: 1px solid #30363d;
      background: #0d1117; color: #c9d1d9; cursor: pointer;
      font-size: 0.9rem; transition: all 0.2s;
    }
    .zoom-btn:hover { background: #30363d; border-color: #58a6ff; }
    .zoom-btn.theory-btn {
      margin-left: auto; background: #1f6feb; border-color: #1f6feb; color: white;
    }
    .zoom-btn.theory-btn:hover { background: #388bfd; }
    .chart-hint {
      color: #8b949e; font-size: 0.75rem; margin-left: 8px;
    }
    
    /* ğŸ†• æ³¢æµªç†è«–æ•™å­¸ Modal */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.85); display: flex;
      align-items: center; justify-content: center; z-index: 1000;
      opacity: 0; visibility: hidden; transition: all 0.3s;
    }
    .modal-overlay.show { opacity: 1; visibility: visible; }
    .modal-content {
      background: #161b22; border-radius: 16px; border: 1px solid #30363d;
      max-width: 95vw; max-height: 90vh; overflow-y: auto;
      padding: 0; position: relative;
    }
    .modal-header {
      position: sticky; top: 0; background: #21262d;
      padding: 16px 24px; border-bottom: 1px solid #30363d;
      display: flex; justify-content: space-between; align-items: center;
      z-index: 10;
    }
    .modal-header h2 { font-size: 1.3rem; color: #58a6ff; }
    .modal-close {
      background: #da3633; color: white; border: none;
      width: 36px; height: 36px; border-radius: 50%;
      font-size: 1.2rem; cursor: pointer; transition: all 0.2s;
    }
    .modal-close:hover { background: #f85149; transform: scale(1.1); }
    .modal-body { padding: 24px; }
    .modal-body img {
      width: 100%; max-width: 1000px; height: auto;
      border-radius: 12px; margin-bottom: 20px;
    }
    
    /* æ³¢æµªèªªæ˜å¡ç‰‡ */
    .wave-theory-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px; margin-top: 20px;
    }
    .wave-theory-card {
      background: #0d1117; border: 1px solid #30363d; border-radius: 12px;
      padding: 16px; transition: all 0.2s;
    }
    .wave-theory-card:hover { border-color: #58a6ff; transform: translateY(-2px); }
    .wave-theory-card h3 {
      display: flex; align-items: center; gap: 8px;
      font-size: 1rem; margin-bottom: 10px;
    }
    .wave-theory-card h3 .wave-num {
      width: 28px; height: 28px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 0.9rem;
    }
    .wave-theory-card p { color: #8b949e; font-size: 0.85rem; line-height: 1.6; }
    .wave-theory-card .keywords {
      margin-top: 10px; display: flex; flex-wrap: wrap; gap: 6px;
    }
    .wave-theory-card .keyword {
      padding: 3px 8px; border-radius: 4px; font-size: 0.7rem;
      background: rgba(88, 166, 255, 0.15); color: #58a6ff;
    }
    
    /* ===== 3AI æ³¢æµªåˆ†ææ¨£å¼ ===== */
    .ai-wave-section {
      margin-top: 24px; padding: 20px; background: #0d1117;
      border: 1px solid #30363d; border-radius: 12px;
    }
    .ai-wave-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 16px; flex-wrap: wrap; gap: 12px;
    }
    .ai-wave-title { font-size: 1.1rem; color: #c9d1d9; display: flex; align-items: center; gap: 8px; }
    .ai-wave-btn {
      background: linear-gradient(135deg, #8b5cf6, #ec4899);
      border: none; color: white; padding: 10px 20px; border-radius: 8px;
      font-weight: 600; cursor: pointer; transition: all 0.2s;
    }
    .ai-wave-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }
    .ai-wave-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    .ai-key-toggle { color: #58a6ff; cursor: pointer; font-size: 0.85rem; }
    .ai-key-toggle:hover { text-decoration: underline; }
    
    .ai-key-panel {
      display: none; background: #161b22; border-radius: 8px; padding: 16px;
      margin-bottom: 16px; border: 1px solid #30363d;
    }
    .ai-key-panel.show { display: block; }
    .ai-key-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
    .ai-key-label { width: 80px; font-size: 0.85rem; color: #8b949e; }
    .ai-key-input {
      flex: 1; min-width: 200px; padding: 8px 12px; border-radius: 6px;
      border: 1px solid #30363d; background: #0d1117; color: #c9d1d9; font-size: 0.85rem;
    }
    .ai-key-input:focus { outline: none; border-color: #58a6ff; }
    .ai-key-status { font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; }
    .ai-key-status.success { background: rgba(63, 185, 80, 0.2); color: #3fb950; }
    .ai-key-status.error { background: rgba(248, 81, 73, 0.2); color: #f85149; }
    .ai-key-status.testing { background: rgba(210, 153, 34, 0.2); color: #d29922; }
    
    .ai-results-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 16px; }
    @media (max-width: 900px) { .ai-results-grid { grid-template-columns: 1fr; } }
    
    .ai-result-card {
      background: #161b22; border: 2px solid #30363d; border-radius: 12px;
      padding: 16px; transition: all 0.3s;
    }
    .ai-result-card.winner { border-color: #f59e0b; box-shadow: 0 0 15px rgba(245, 158, 11, 0.3); }
    .ai-result-card .ai-name {
      display: flex; align-items: center; gap: 8px; margin-bottom: 12px;
      font-weight: 600; font-size: 1rem;
    }
    .ai-result-card .ai-name img { width: 24px; height: 24px; border-radius: 4px; }
    .ai-result-card .ai-wave-result {
      text-align: center; padding: 12px; background: #0d1117; border-radius: 8px; margin-bottom: 12px;
    }
    .ai-result-card .wave-num-display {
      font-size: 2.5rem; font-weight: 900; margin: 8px 0;
    }
    .ai-result-card .wave-score { font-size: 0.9rem; color: #8b949e; }
    .ai-result-card .ai-analysis { font-size: 0.85rem; color: #8b949e; line-height: 1.5; }
    
    .ai-verdict-box {
      margin-top: 20px; padding: 16px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1));
      border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; text-align: center;
    }
    .ai-verdict-title { font-size: 0.9rem; color: #8b949e; margin-bottom: 8px; }
    .ai-verdict-wave { font-size: 3rem; font-weight: 900; color: #f59e0b; }
    .ai-verdict-summary { font-size: 0.9rem; color: #c9d1d9; margin-top: 12px; line-height: 1.6; }
    .ai-verdict-meta { font-size: 0.8rem; color: #8b949e; margin-top: 8px; }
    
    .ai-loading { text-align: center; padding: 40px; color: #8b949e; }
    .ai-loading .spinner { width: 40px; height: 40px; border: 3px solid #30363d; border-top-color: #8b5cf6; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>ğŸŒŠ <span>è‰¾ç•¥ç‰¹æ³¢æµªç†è«–åˆ†æ</span></h1>
      <div class="search-box">
        <input type="text" id="stockInput" placeholder="è‚¡ç¥¨ä»£ç¢¼" value="2330" />
        <button class="btn btn-primary" onclick="analyzeStock()">ğŸ” åˆ†ææ³¢æµª</button>
      </div>
    </header>
    
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="showTab('wave')">ğŸŒŠ æ³¢æµªåˆ†æ</button>
      <button class="tab" onclick="showTab('portfolio')">ğŸ’¼ æŠ•è³‡çµ„åˆ</button>
    </div>

    <!-- Wave Tab -->
    <div id="waveTab">
      <div class="main-card">
        <div class="card-header">
          <h2>ğŸ“ˆ <span id="stockName">è¼‰å…¥ä¸­...</span> (<span id="stockId">----</span>)</h2>
          <span id="confidenceBadge" style="padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; background: rgba(210, 153, 34, 0.2); color: #d29922;">ä¿¡å¿ƒ: --</span>
        </div>
        <div class="card-body">
          <!-- Chart with Wave Labels -->
          <div class="chart-section">
            <!-- ğŸ†• ç¸®æ”¾æ§åˆ¶æŒ‰éˆ• -->
            <div class="chart-controls">
              <button class="zoom-btn" onclick="zoomIn()" title="æ”¾å¤§">â•</button>
              <button class="zoom-btn" onclick="zoomOut()" title="ç¸®å°">â–</button>
              <button class="zoom-btn" onclick="resetZoom()" title="é‡ç½®">ğŸ”„</button>
              <span class="chart-hint">ğŸ–±ï¸ æ»¾è¼ªç¸®æ”¾ | æ‹–æ›³å¹³ç§»</span>
              <button class="zoom-btn theory-btn" onclick="showTheory()" title="æ³¢æµªç†è«–æ•™å­¸">ğŸ“š æ³¢æµªç†è«–</button>
            </div>
            <div class="chart-container"><canvas id="priceChart"></canvas></div>
            <div class="chart-legend">
              <div class="legend-item"><div class="legend-dot" style="background:#238636;"></div>æ¨å‹•æµª (1,3,5)</div>
              <div class="legend-item"><div class="legend-dot" style="background:#1f6feb;"></div>ä¿®æ­£æµª (2,4)</div>
              <div class="legend-item"><div class="legend-dot" style="background:#da3633;"></div>ä¸‹è·Œæµª (A,C)</div>
              <div class="legend-item"><div class="legend-dot" style="background:#d29922;"></div>åå½ˆæµª (B)</div>
            </div>
          </div>
          
          <!-- Wave Analysis Box -->
          <div class="wave-analysis-box">
            <div class="wave-analysis-title">ğŸŒŠ è‰¾ç•¥ç‰¹æ³¢æµªåˆ†æ</div>
            
            <!-- Wave Circles (1-5, A-B-C) -->
            <div class="wave-circles" id="waveCircles">
              <div class="wave-circle w1">1</div>
              <div class="wave-circle w2">2</div>
              <div class="wave-circle w3">3</div>
              <div class="wave-circle w4">4</div>
              <div class="wave-circle w5">5</div>
              <div class="wave-circle wA">A</div>
              <div class="wave-circle wB">B</div>
              <div class="wave-circle wC">C</div>
            </div>
            
            <!-- Current Wave -->
            <div class="current-wave-display">
              <span class="label">ç›®å‰æ¨æ¸¬ä½æ–¼</span>
              <span class="wave-label">ç¬¬</span>
              <span class="wave-number" id="currentWave">--</span>
              <span class="wave-label">æµª</span>
            </div>
            
            <!-- Trend Info -->
            <div class="trend-info">
              <span id="trendText">--</span>
              <span class="separator">|</span>
              <span>ç¾åƒ¹: <strong id="currentPrice">--</strong></span>
              <span id="changePercent">--</span>
              <span id="fromWaveText" class="from-wave-badge up">è‡ªä¸Šæµª --</span>
            </div>
          </div>
          
          <!-- Three Columns -->
          <div class="three-columns">
            <!-- Rules Check -->
            <div class="column-card">
              <div class="column-header">ğŸ“‹ æ³¢æµªè¦å‰‡æª¢æŸ¥</div>
              <div class="column-body" id="rulesContainer">
                <div class="loading"><div class="spinner"></div></div>
              </div>
            </div>
            
            <!-- Wave History -->
            <div class="column-card">
              <div class="column-header">ğŸ“Š è¿‘æœŸæ³¢æµª</div>
              <div class="column-body" id="waveHistoryContainer">
                <div class="loading"><div class="spinner"></div></div>
              </div>
            </div>
            
            <!-- Suggestion -->
            <div class="column-card">
              <div class="column-header">ğŸ’¡ æ“ä½œå»ºè­°</div>
              <div class="column-body">
                <div class="suggestion-box">
                  <p id="suggestionText">è¼‰å…¥ä¸­...</p>
                </div>
                <div class="targets-row">
                  <div class="target-box up">
                    <div class="label">ğŸ¯ ç›®æ¨™ä¸Šæª”</div>
                    <div class="value" id="targetUp">--</div>
                  </div>
                  <div class="target-box down">
                    <div class="label">ğŸ›¡ï¸ æ”¯æ’ä¸‹æª”</div>
                    <div class="value" id="targetDown">--</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Bottom Row -->
          <div class="three-columns" style="grid-template-columns: 1fr 1fr; margin-top: 16px;">
            <div class="column-card">
              <div class="column-header">ğŸ“… æœ€è¿‘äº¤æ˜“æ—¥æ•¸æ“š</div>
              <div class="column-body" id="recentDataContainer">
                <div class="loading"><div class="spinner"></div></div>
              </div>
            </div>
            <div class="column-card">
              <div class="column-header">ğŸ“ æ–æ³¢é‚£å¥‘æ¯”ä¾‹</div>
              <div class="column-body" id="fibContainer">
                <div class="loading"><div class="spinner"></div></div>
              </div>
            </div>
          </div>
          
          <!-- ğŸ†• 3AI æ³¢æµªåˆ†æå€ -->
          <div class="ai-wave-section">
            <div class="ai-wave-header">
              <div class="ai-wave-title">ğŸ¤– 3AI æ³¢æµªæ™ºæ…§åˆ†æ</div>
              <div style="display: flex; align-items: center; gap: 12px;">
                <span class="ai-key-toggle" onclick="toggleAIKeyPanel()">âš™ï¸ API è¨­å®š</span>
                <button class="ai-wave-btn" id="aiWaveBtn" onclick="run3AIWaveAnalysis()">ğŸš€ å•Ÿå‹• 3AI åˆ†æ</button>
              </div>
            </div>
            
            <!-- API Key è¨­å®šé¢æ¿ -->
            <div class="ai-key-panel" id="aiKeyPanel">
              <div class="ai-key-row">
                <span class="ai-key-label">ğŸŸ£ Claude</span>
                <input type="password" class="ai-key-input" id="claudeKeyInput" placeholder="sk-ant-..." />
                <span class="ai-key-status" id="claudeKeyStatus"></span>
                <button class="btn" style="padding: 6px 12px; font-size: 0.8rem;" onclick="testAIKey('claude')">æ¸¬è©¦</button>
              </div>
              <div class="ai-key-row">
                <span class="ai-key-label">ğŸ”µ Gemini</span>
                <input type="password" class="ai-key-input" id="geminiKeyInput" placeholder="AIza..." />
                <span class="ai-key-status" id="geminiKeyStatus"></span>
                <button class="btn" style="padding: 6px 12px; font-size: 0.8rem;" onclick="testAIKey('gemini')">æ¸¬è©¦</button>
              </div>
              <div class="ai-key-row">
                <span class="ai-key-label">ğŸŸ¢ OpenAI</span>
                <input type="password" class="ai-key-input" id="openaiKeyInput" placeholder="sk-..." />
                <span class="ai-key-status" id="openaiKeyStatus"></span>
                <button class="btn" style="padding: 6px 12px; font-size: 0.8rem;" onclick="testAIKey('openai')">æ¸¬è©¦</button>
              </div>
              <div style="margin-top: 12px; display: flex; gap: 10px;">
                <button class="btn btn-primary" style="padding: 8px 16px;" onclick="saveAIKeys()">ğŸ’¾ å„²å­˜é‡‘é‘°</button>
                <button class="btn" style="padding: 8px 16px;" onclick="clearAIKeys()">ğŸ—‘ï¸ æ¸…é™¤</button>
              </div>
            </div>
            
            <!-- 3AI åˆ†æçµæœå€ -->
            <div id="aiWaveResults"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Tab -->
    <div id="portfolioTab" class="hidden">
      <div class="main-card">
        <div class="card-header"><h2>ğŸ’¼ è‡ªè¨‚æŠ•è³‡çµ„åˆ</h2></div>
        <div class="card-body">
          <!-- Controls -->
          <div class="portfolio-controls">
            <span style="color: #8b949e;">é ç®—ï¼š</span>
            <input type="number" id="budgetInput" value="60" style="width: 80px;" />
            <span style="color: #8b949e;">è¬å…ƒ</span>
            <div class="budget-btns">
              <button class="budget-btn" onclick="setBudget(30)">30è¬</button>
              <button class="budget-btn" onclick="setBudget(50)">50è¬</button>
              <button class="budget-btn active" onclick="setBudget(60)">60è¬</button>
              <button class="budget-btn" onclick="setBudget(100)">100è¬</button>
              <button class="budget-btn" onclick="setBudget(200)">200è¬</button>
            </div>
            <button class="btn btn-primary" onclick="refreshAllWaves()" style="margin-left: auto;">ğŸ”„ é‡æ–°è¨ˆç®—</button>
          </div>
          
          <!-- Summary -->
          <div class="summary-grid">
            <div class="summary-card">
              <div class="label">ç¸½é ç®—</div>
              <div class="value" style="color: #c9d1d9;" id="sumBudget">$600,000</div>
            </div>
            <div class="summary-card">
              <div class="label">è‚¡ç¥¨é…ç½®</div>
              <div class="value" style="color: #3fb950;" id="sumStock">$552,000</div>
            </div>
            <div class="summary-card">
              <div class="label">ç¾é‡‘ä¿ç•™</div>
              <div class="value" style="color: #d29922;" id="sumCash">$48,000</div>
            </div>
            <div class="summary-card">
              <div class="label">é¢¨éšªåˆ†æ•¸</div>
              <div class="value" style="color: #58a6ff;" id="sumRiskScore">45</div>
            </div>
            <div class="summary-card">
              <div class="label">é¢¨éšªç­‰ç´š</div>
              <div class="value" id="sumRiskLevel" style="color: #3fb950;">ä½</div>
            </div>
          </div>
          
          <!-- Stock List -->
          <div class="stock-header">
            <span>è‚¡ç¥¨</span><span>é¡è‚¡/åŸå› </span><span>é…ç½®é‡‘é¡</span><span>æ¯”ä¾‹</span><span>æ³¢æµª</span><span>æ“ä½œ</span>
          </div>
          <div id="stockList"></div>
          
          <!-- Add Form -->
          <div class="add-form">
            <input type="text" id="newId" placeholder="ä»£ç¢¼" style="width: 70px;" />
            <input type="text" id="newName" placeholder="åç¨±" style="width: 90px;" />
            <input type="text" id="newSector" placeholder="é¡è‚¡" style="width: 80px;" />
            <input type="number" id="newPercent" placeholder="%" style="width: 50px;" value="5" />
            <input type="text" id="newReason" placeholder="æŠ•è³‡åŸå› " />
            <button class="btn btn-primary" onclick="addStock()">â• æ–°å¢</button>
          </div>
          
          <!-- Risk Section -->
          <div class="risk-section">
            <h3 style="font-size: 0.95rem; color: #c9d1d9; margin-bottom: 8px;">ğŸ“Š é¢¨éšªè©•ä¼°</h3>
            <div class="risk-bar-bg">
              <div class="risk-indicator" id="riskIndicator" style="left: 35%;">35</div>
            </div>
            <div class="risk-labels">
              <span>ğŸŸ¢ ä½é¢¨éšª</span><span>ğŸŸ¡ ä¸­é¢¨éšª</span><span>ğŸ”´ é«˜é¢¨éšª</span>
            </div>
            <div class="risk-comment" id="riskComment">çµ„åˆé¢¨éšªè©•ä¼°ä¸­...</div>
          </div>
          
          <!-- Sector Distribution -->
          <div class="sector-section">
            <h3 style="font-size: 0.95rem; color: #c9d1d9; margin-bottom: 12px;">ğŸ“Š é¡è‚¡åˆ†æ•£</h3>
            <div id="sectorBars"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let priceChart = null;
    let currentPivots = [];
    let currentHistory = [];
    
    // æŠ•è³‡çµ„åˆï¼ˆé è¨­å€¼ï¼Œæœƒåœ¨é é¢è¼‰å…¥æ™‚æ›´æ–°æ³¢æµªï¼‰
    let portfolio = [
      { id: '2344', name: 'è¯é‚¦é›»', sector: 'è¨˜æ†¶é«”', percent: 40, wave: '?', reason: 'æ™¯æ°£å¾ªç’°' },
      { id: 'CASH', name: 'ç¾é‡‘ä¿ç•™', sector: 'ç¾é‡‘', percent: 5, wave: '-', reason: 'ç­‰å¾…æ™‚æ©Ÿ' },
      { id: '6770', name: 'åŠ›ç©é›»', sector: 'è¨˜æ†¶é«”', percent: 45, wave: '?', reason: 'å¥—åˆ©' },
      { id: '3059', name: 'è¯æ™¶ç§‘', sector: 'æ©Ÿå™¨äºº', percent: 5, wave: '?', reason: 'å¥—åˆ©' },
      { id: '2313', name: 'è¯é€š', sector: 'ä½è»Œè¡›æ˜Ÿ', percent: 5, wave: '?', reason: 'å¥—åˆ©' }
    ];
    
    // æ³¢æµªèªªæ˜
    const waveDesc = {
      1: 'ã€ç¬¬1æµª åˆå‡æ®µã€‘è‚¡ç¥¨é¦–æ¬¡ä¸Šæ¼²ï¼Œå°‘æ•¸äººèªå‡ºã€‚ç­–ç•¥ï¼šå°é‡è©¦å–®ï¼Œè§€å¯Ÿç¢ºèªã€‚',
      2: 'ã€ç¬¬2æµª å›èª¿ã€‘ç²åˆ©äº†çµé€ æˆä¸‹è·Œï¼Œä½†ä¸è·Œç ´ç¬¬1æµªä½é»ã€‚ç­–ç•¥ï¼šç­‰å¾…å›èª¿å¾Œé€²å ´ã€‚',
      3: 'ã€ç¬¬3æµª ä¸»å‡æ®µã€‘æœ€å¼·æœ€é•·çš„ä¸€æ³¢ï¼å¸å¼•å…¬çœ¾ç›®å…‰ã€‚ç­–ç•¥ï¼šæŒè‚¡çºŒæŠ±ï¼Œå¯åŠ ç¢¼ï¼',
      4: 'ã€ç¬¬4æµª æ•´ç†ã€‘éƒ¨åˆ†ç²åˆ©äº†çµï¼Œä¸è·Œç ´ç¬¬1æµªé«˜é»ã€‚ç­–ç•¥ï¼šæŒè‚¡è§€æœ›ã€‚',
      5: 'ã€ç¬¬5æµª æœ«å‡æ®µã€‘å¸‚å ´æ¥µåº¦æ¨‚è§€ï¼ŒCEOä¸Šé›œèªŒå°é¢ã€‚ç­–ç•¥ï¼šåˆ†æ‰¹ç²åˆ©äº†çµï¼',
      A: 'ã€Aæµª ä¸‹è·Œé–‹å§‹ã€‘ä¸‹è·Œé–‹å§‹ï¼Œå¤šæ•¸äººèªç‚ºæš«æ™‚å›æª”ã€‚ç­–ç•¥ï¼šæ¸›ç¢¼æˆ–åœæï¼',
      B: 'ã€Bæµª åå½ˆé™·é˜±ã€‘å°Aæµªçš„åå½ˆï¼Œæ˜¯ã€Œå¤šé ­é™·é˜±ã€ã€‚ç­–ç•¥ï¼šä¸å®œè¿½é«˜ï¼',
      C: 'ã€Cæµª ä¸»è·Œæ®µã€‘ç ´å£åŠ›æœ€å¼·çš„ä¸‹è·Œæµªï¼Œå…¨é¢æ€§ä¸‹è·Œã€‚ç­–ç•¥ï¼šç©ºæ‰‹è§€æœ›ï¼'
    };
    
    // æ³¢æµªé¡è‰²å°æ‡‰
    const waveColors = {
      '1': '#238636', '3': '#238636', '5': '#238636',  // æ¨å‹•æµª=ç¶ 
      '2': '#1f6feb', '4': '#1f6feb',                   // ä¿®æ­£æµª=è—
      'A': '#da3633', 'C': '#da3633',                   // ä¸‹è·Œæµª=ç´…
      'B': '#d29922'                                     // åå½ˆæµª=æ©˜
    };
    
    // ğŸ†• 3AI æ³¢æµªåˆ†æç›¸é—œè®Šæ•¸
    let currentWaveData = null;  // å„²å­˜ç•¶å‰æ³¢æµªåˆ†ææ•¸æ“š
    
    window.onload = async function() {
      const urlParams = new URLSearchParams(window.location.search);
      document.getElementById('stockInput').value = urlParams.get('stock') || '2330';
      analyzeStock();
      renderPortfolio();
      
      // ğŸ†• è¼‰å…¥å·²å­˜çš„ API é‡‘é‘°
      loadAIKeys();
      
      // ğŸ†• è‡ªå‹•åˆ·æ–°æŠ•è³‡çµ„åˆçš„æ³¢æµªï¼ˆèƒŒæ™¯åŸ·è¡Œï¼‰
      setTimeout(async () => {
        for (let i = 0; i < portfolio.length; i++) {
          const s = portfolio[i];
          if (s.id === 'CASH' || s.wave !== '?') continue;
          try {
            const res = await fetch(`/api/line/wave/analyze/${s.id}?_t=${Date.now()}`);
            if (res.ok) {
              const data = await res.json();
              if (data.currentWave && !data.error) {
                portfolio[i].wave = data.currentWave;
                renderPortfolio();
              }
            }
          } catch (e) {}
          await new Promise(r => setTimeout(r, 500));
        }
      }, 2000);
    };
    
    function showTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab')[tab === 'wave' ? 0 : 1].classList.add('active');
      document.getElementById('waveTab').classList.toggle('hidden', tab !== 'wave');
      document.getElementById('portfolioTab').classList.toggle('hidden', tab !== 'portfolio');
    }
    
    async function analyzeStock() {
      const stockId = document.getElementById('stockInput').value.trim();
      if (!stockId) return alert('è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼');
      showLoading();
      
      try {
        const res = await fetch(`/api/line/wave/analyze/${stockId}?_t=${Date.now()}`);
        
        // æª¢æŸ¥å›æ‡‰é¡å‹
        const contentType = res.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          console.error('API å›æ‡‰é JSON:', contentType);
          throw new Error('ä¼ºæœå™¨å›æ‡‰æ ¼å¼éŒ¯èª¤ï¼Œè«‹ç¢ºèª API æ˜¯å¦æ­£ç¢ºéƒ¨ç½²');
        }
        
        if (!res.ok) {
          throw new Error(`HTTP éŒ¯èª¤: ${res.status}`);
        }
        
        const data = await res.json();
        if (data.error) throw new Error(data.error);
        
        // å„²å­˜æ•¸æ“šä¾›åœ–è¡¨ä½¿ç”¨
        currentPivots = data.pivots || [];
        currentHistory = data.history || [];
        currentWaveData = data;  // ğŸ†• å„²å­˜å®Œæ•´æ•¸æ“šä¾› 3AI åˆ†æä½¿ç”¨
        
        renderAnalysis(data);
      } catch (e) {
        console.error('åˆ†æéŒ¯èª¤:', e);
        alert('åˆ†æå¤±æ•—: ' + e.message);
      }
    }
    
    function renderAnalysis(data) {
      document.getElementById('stockName').textContent = data.stockName || data.stockId;
      document.getElementById('stockId').textContent = data.stockId;
      document.getElementById('currentPrice').textContent = '$' + (data.currentPrice || 0).toFixed(2);
      document.getElementById('currentWave').textContent = data.currentWave || '--';
      
      // æ¼²è·Œï¼ˆå°è‚¡ï¼šæ¼²=ç´…ï¼Œè·Œ=ç¶ ï¼‰
      const change = data.changePercent || 0;
      const changeEl = document.getElementById('changePercent');
      changeEl.textContent = (change >= 0 ? 'â–²' : 'â–¼') + Math.abs(change).toFixed(2) + '%';
      changeEl.className = change >= 0 ? 'up' : 'down';
      
      // è¶¨å‹¢
      const wave = data.currentWave;
      const isUp = [1,2,3,4,5,'1','2','3','4','5'].includes(wave);
      document.getElementById('trendText').textContent = isUp ? 'ä¸Šå‡è¶¨å‹¢' : 'ä¸‹é™è¶¨å‹¢';
      document.getElementById('trendText').className = isUp ? 'up' : 'down';
      
      // è‡ªä¸Šæµªè®ŠåŒ–
      const fromWaveEl = document.getElementById('fromWaveText');
      const fromChange = data.fromWaveChange || change;
      fromWaveEl.textContent = `è‡ªä¸Šæµª ${fromChange >= 0 ? '+' : ''}${fromChange.toFixed(1)}%`;
      fromWaveEl.className = 'from-wave-badge ' + (fromChange >= 0 ? 'up' : 'down');
      
      // ä¿¡å¿ƒåˆ†æ•¸
      const conf = data.confidence || 50;
      const confEl = document.getElementById('confidenceBadge');
      confEl.textContent = `ä¿¡å¿ƒ: ${conf}%`;
      confEl.style.background = conf >= 70 ? 'rgba(63,185,80,0.2)' : conf >= 40 ? 'rgba(210,153,34,0.2)' : 'rgba(248,81,73,0.2)';
      confEl.style.color = conf >= 70 ? '#3fb950' : conf >= 40 ? '#d29922' : '#f85149';
      
      // æ³¢æµªåœ“åœˆ
      renderWaveCircles(wave);
      
      // å…¶ä»–
      document.getElementById('suggestionText').textContent = data.suggestion || 'è«‹çµåˆå…¶ä»–æŠ€è¡“æŒ‡æ¨™ç¶œåˆåˆ¤æ–·ã€‚';
      document.getElementById('targetUp').textContent = '$' + (data.targetUp || 0).toFixed(1);
      document.getElementById('targetDown').textContent = '$' + (data.targetDown || 0).toFixed(1);
      
      renderRules(data.rules);
      renderWaveHistory(data.waves, data.currentPrice, wave);
      renderFibonacci(data);
      renderRecentData(data.history);
      renderChart(data);
    }
    
    function renderWaveCircles(currentWave) {
      const waves = ['1', '2', '3', '4', '5', 'A', 'B', 'C'];
      const container = document.getElementById('waveCircles');
      
      container.innerHTML = waves.map(w => {
        const isActive = String(currentWave) === w;
        let cls = 'w' + w;
        if (w === 'A' || w === 'C') cls = 'wA';
        else if (w === 'B') cls = 'wB';
        return `<div class="wave-circle ${cls} ${isActive ? 'active' : ''}" onclick="alert('${waveDesc[w]}')">${w}</div>`;
      }).join('');
    }
    
    function renderRules(rules) {
      const r = rules || [
        { rule: 'ç¬¬2æµªä¸è·Œç ´ç¬¬1æµªèµ·é»', pass: true },
        { rule: 'ç¬¬3æµªä¸æ˜¯æœ€çŸ­æ¨å‹•æµª', pass: true },
        { rule: 'ç¬¬4æµªä¸é‡ç–Šç¬¬1æµªå€é–“', pass: true }
      ];
      document.getElementById('rulesContainer').innerHTML = r.map(x => `
        <div class="rule-item ${x.pass ? 'pass' : 'fail'}">
          <span class="rule-icon">${x.pass ? 'âœ…' : 'âŒ'}</span>
          <span class="rule-text">${x.rule}</span>
        </div>
      `).join('');
    }
    
    function renderWaveHistory(waves, currentPrice, currentWave) {
      const container = document.getElementById('waveHistoryContainer');
      if (!waves || !waves.length) {
        container.innerHTML = '<div style="color: #8b949e; text-align: center; padding: 20px;">æš«ç„¡æ³¢æµªæ•¸æ“š</div>';
        return;
      }
      
      // æ³¢æµªæ­·å²ï¼šç”±èˆŠåˆ°æ–°æ’åº
      const order = { '1':1, '2':2, '3':3, '4':4, '5':5, 'A':6, 'B':7, 'C':8, 1:1, 2:2, 3:3, 4:4, 5:5 };
      const sortedWaves = [...waves].sort((a, b) => (order[a.wave] || 99) - (order[b.wave] || 99));
      
      container.innerHTML = sortedWaves.slice(0, 6).map(w => {
        const up = w.end > w.start;
        const pct = ((w.end - w.start) / w.start * 100).toFixed(1);
        const type = [1,3,5,'1','3','5'].includes(w.wave) ? 'æ¨å‹•' : 'ä¿®æ­£';
        const isCurrent = String(w.wave) === String(currentWave);
        
        return `
          <div class="wave-history-item ${isCurrent ? 'current' : ''}">
            <div>
              <div class="wave-name">ç¬¬ ${w.wave} æµª (${type})</div>
              ${isCurrent ? '<div class="wave-type">â† ç›®å‰</div>' : ''}
            </div>
            <div class="wave-price ${up ? 'up' : 'down'}">
              ${w.start.toFixed(1)} â†’ ${w.end.toFixed(1)}
            </div>
          </div>
        `;
      }).join('');
      
      // ç¾åƒ¹
      if (currentPrice) {
        container.innerHTML += `
          <div class="wave-history-item" style="background: rgba(88,166,255,0.1); border: 1px solid rgba(88,166,255,0.3);">
            <span style="color: #58a6ff;">ğŸ“ ç¾åƒ¹</span>
            <span style="color: #c9d1d9; font-weight: 700;">$${currentPrice.toFixed(2)}</span>
          </div>
        `;
      }
    }
    
    function renderFibonacci(data) {
      const price = data.currentPrice || 100;
      const high = data.targetUp || price * 1.1;
      const low = data.targetDown || price * 0.9;
      const range = high - low;
      
      const levels = [
        { r: '0%', p: low, c: '#3fb950' },
        { r: '23.6%', p: low + range * 0.236, c: '#58a6ff' },
        { r: '38.2%', p: low + range * 0.382, c: '#58a6ff' },
        { r: '50%', p: low + range * 0.5, c: '#d29922' },
        { r: '61.8%', p: low + range * 0.618, c: '#d29922' },
        { r: '100%', p: high, c: '#f85149' }
      ];
      
      document.getElementById('fibContainer').innerHTML = levels.map(l => {
        const near = Math.abs(l.p - price) < range * 0.08;
        return `
          <div class="fib-row" style="background: ${near ? 'rgba(88,166,255,0.15)' : '#161b22'}; border-color: ${l.c};">
            <span class="fib-ratio" style="color: ${l.c};">${l.r}</span>
            <span class="fib-price">$${l.p.toFixed(2)}</span>
          </div>
        `;
      }).join('');
    }
    
    function renderRecentData(history) {
      const container = document.getElementById('recentDataContainer');
      if (!history || !history.length) {
        container.innerHTML = '<div style="color: #8b949e; text-align: center;">æš«ç„¡æ•¸æ“š</div>';
        return;
      }
      
      // history å·²ç¶“æ˜¯æ­£åºï¼ˆèˆŠâ†’æ–°ï¼‰ï¼Œå–æœ€å¾Œ10ç­†é¡¯ç¤º
      const recent = history.slice(-10);
      
      container.innerHTML = `
        <table class="data-table">
          <thead><tr>
            <th>æ—¥æœŸ</th><th style="text-align:right;">é–‹</th><th style="text-align:right;">é«˜</th>
            <th style="text-align:right;">ä½</th><th style="text-align:right;">æ”¶</th>
          </tr></thead>
          <tbody>
            ${recent.map(d => {
              const up = d.close >= d.open;
              return `<tr class="${up ? 'up' : 'down'}">
                <td style="color: #8b949e;">${d.date ? new Date(d.date).toLocaleDateString('zh-TW') : '-'}</td>
                <td style="text-align:right;">${d.open?.toFixed(1) || '-'}</td>
                <td style="text-align:right;">${d.high?.toFixed(1) || '-'}</td>
                <td style="text-align:right;">${d.low?.toFixed(1) || '-'}</td>
                <td style="text-align:right; font-weight:600;">${d.close?.toFixed(1) || '-'}</td>
              </tr>`;
            }).join('')}
          </tbody>
        </table>
        <div style="font-size: 0.7rem; color: #6b7280; text-align: center; margin-top: 8px;">
          å…± ${history.length} å¤©æ­·å²è³‡æ–™
        </div>
      `;
    }
    
    function renderChart(data) {
      const ctx = document.getElementById('priceChart').getContext('2d');
      if (priceChart) priceChart.destroy();
      
      const history = data.history || [];
      if (history.length === 0) return;
      
      // âš ï¸ API è¿”å›çš„ history å·²ç¶“æ˜¯æ­£åºï¼ˆèˆŠâ†’æ–°ï¼‰ï¼Œç›´æ¥ä½¿ç”¨ï¼
      // å·¦é‚Š = æœ€èˆŠï¼Œå³é‚Š = æœ€æ–°
      const labels = history.map(h => h.date ? new Date(h.date).toLocaleDateString('zh-TW', {month:'numeric', day:'numeric'}) : '');
      const prices = history.map(h => h.close);
      
      // å»ºç«‹æ³¢æµªæ¨™è¨˜ annotations - å¾ waves é™£åˆ—å–å¾—
      const annotations = {};
      const waves = data.waves || [];
      const dates = history.map(h => h.date);  // ğŸ”§ æ–°å¢ï¼šç”¨æ–¼æ—¥æœŸåŒ¹é…
      
      // ğŸ†• è¨˜éŒ„å·²ä½¿ç”¨çš„ä½ç½®ï¼Œé¿å…é‡ç–Š
      const usedPositions = [];
      const priceRange = Math.max(...prices) - Math.min(...prices);  // ğŸ”§ é å…ˆè¨ˆç®—åƒ¹æ ¼ç¯„åœ
      const wavePositions = [];  // ğŸ†• å„²å­˜æ³¢æµªä½ç½®ï¼Œç”¨æ–¼ç¹ªè£½é€£æ¥ç·š
      
      // ç‚ºæ¯å€‹æ³¢æµªæ‰¾åˆ°å°æ‡‰çš„åƒ¹æ ¼ä½ç½®ä¸¦æ¨™è¨˜
      waves.forEach((w, i) => {
        const waveLabel = String(w.wave);
        const color = waveColors[waveLabel] || '#58a6ff';
        
        // ğŸ”§ å„ªåŒ–ï¼šä½¿ç”¨å¤šé‡åŒ¹é…ç­–ç•¥ï¼ˆå„ªå…ˆä½¿ç”¨ endIndexï¼Œå…¶æ¬¡ endDateï¼Œæœ€å¾Œåƒ¹æ ¼ï¼‰
        let bestIdx = -1;
        
        // æ–¹æ³•1: ç›´æ¥ä½¿ç”¨ endIndexï¼ˆæœ€æº–ç¢ºï¼‰
        if (w.endIndex !== undefined && w.endIndex >= 0 && w.endIndex < history.length) {
          bestIdx = w.endIndex;
        }
        // æ–¹æ³•2: ä½¿ç”¨ endDate åŒ¹é…
        else if (w.endDate) {
          bestIdx = dates.findIndex(d => d === w.endDate);
          // å¦‚æœæ‰¾ä¸åˆ°ç²¾ç¢ºåŒ¹é…ï¼Œæ‰¾æœ€æ¥è¿‘çš„æ—¥æœŸ
          if (bestIdx < 0) {
            const endTime = new Date(w.endDate).getTime();
            let minDiff = Infinity;
            for (let j = 0; j < dates.length; j++) {
              if (dates[j]) {
                const diff = Math.abs(new Date(dates[j]).getTime() - endTime);
                if (diff < minDiff) {
                  minDiff = diff;
                  bestIdx = j;
                }
              }
            }
          }
        }
        // æ–¹æ³•3: ä½¿ç”¨åƒ¹æ ¼+æ™‚é–“ç¯„åœåŒ¹é…ï¼ˆå‚™æ´ï¼Œé™åˆ¶åœ¨åˆç†æ™‚é–“ç¯„åœå…§ï¼‰
        if (bestIdx < 0) {
          let bestScore = Infinity;
          const waveNum = parseInt(waveLabel) || (waveLabel === 'A' ? 6 : waveLabel === 'B' ? 7 : 8);
          // ä¼°ç®—æ³¢æµªå¤§ç´„å‡ºç¾çš„æ™‚é–“ç¯„åœ
          const expectedRange = Math.floor(history.length * (waveNum / 10));
          const searchStart = Math.max(0, expectedRange - Math.floor(history.length * 0.3));
          const searchEnd = Math.min(history.length, expectedRange + Math.floor(history.length * 0.3));
          
          for (let j = searchStart; j < searchEnd; j++) {
            const priceDiff = Math.abs(prices[j] - w.end);
            const timePenalty = Math.abs(j - expectedRange) * 0.1;  // æ™‚é–“è·é›¢æ‡²ç½°
            const score = priceDiff + timePenalty;
            if (score < bestScore) {
              bestScore = score;
              bestIdx = j;
            }
          }
          // å¦‚æœç¯„åœå…§æ‰¾ä¸åˆ°ï¼Œæ“´å¤§æœç´¢
          if (bestIdx < 0) {
            for (let j = 0; j < prices.length; j++) {
              const priceDiff = Math.abs(prices[j] - w.end);
              if (priceDiff < bestScore) {
                bestScore = priceDiff;
                bestIdx = j;
              }
            }
          }
        }
        
        // ç¢ºä¿æ¨™è¨˜ä¸é‡ç–Š
        if (bestIdx >= 0 && bestIdx < prices.length) {
          // ğŸ†• æª¢æŸ¥æ˜¯å¦èˆ‡å·²æœ‰æ¨™è¨˜é‡ç–Šï¼Œè‹¥é‡ç–Šå‰‡å¾®èª¿ä½ç½®
          let yAdjust = 0;
          const isHigh = w.end > w.start;
          
          // æª¢æŸ¥é‡ç–Šï¼ˆä½¿ç”¨æ›´ç²¾ç¢ºçš„é–¾å€¼ï¼‰
          for (const pos of usedPositions) {
            if (Math.abs(pos.x - bestIdx) < 5 && Math.abs(pos.y - w.end) < priceRange * 0.08) {
              yAdjust += isHigh ? -30 : 30;
            }
          }
          
          usedPositions.push({ x: bestIdx, y: w.end });
          wavePositions.push({ idx: bestIdx, price: w.end, wave: waveLabel, color });  // ğŸ†• è¨˜éŒ„ä½ç½®
          
          annotations['wave_' + i] = {
            type: 'label',
            xValue: bestIdx,
            yValue: w.end,
            content: waveLabel,
            backgroundColor: color,
            color: 'white',
            font: { size: 14, weight: 'bold' },
            padding: { top: 6, bottom: 6, left: 10, right: 10 },
            borderRadius: 14,
            borderWidth: 2,
            borderColor: 'white',
            yAdjust: (isHigh ? -25 : 25) + yAdjust  // ğŸ”§ å¾®èª¿åç§»é‡
          };
        }
      });
      
      // ğŸ†• ç¹ªè£½æ³¢æµªé€£æ¥ç·šï¼ˆè™›ç·šï¼‰
      for (let i = 1; i < wavePositions.length; i++) {
        const prev = wavePositions[i - 1];
        const curr = wavePositions[i];
        annotations['waveLine_' + i] = {
          type: 'line',
          xMin: prev.idx,
          xMax: curr.idx,
          yMin: prev.price,
          yMax: curr.price,
          borderColor: 'rgba(88, 166, 255, 0.4)',
          borderWidth: 1,
          borderDash: [4, 4]
        };
      }
      
      // åŠ ä¸Šç¾åƒ¹æ¨™è¨˜
      if (data.currentPrice && prices.length > 0) {
        annotations['current'] = {
          type: 'line',
          yMin: data.currentPrice,
          yMax: data.currentPrice,
          borderColor: '#58a6ff',
          borderWidth: 2,
          borderDash: [5, 5],
          label: {
            display: true,
            content: `ç¾åƒ¹ $${data.currentPrice.toFixed(1)}`,
            position: 'end',
            backgroundColor: '#58a6ff',
            color: 'white',
            font: { size: 11, weight: 'bold' }
          }
        };
      }
      
      priceChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            data: prices,
            borderColor: '#58a6ff',
            backgroundColor: 'rgba(88, 166, 255, 0.1)',
            fill: true,
            tension: 0.3,
            pointRadius: 1,
            pointHoverRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { 
            legend: { display: false },
            annotation: { annotations },
            // ğŸ†• ç¸®æ”¾æ’ä»¶è¨­å®šï¼ˆç°¡åŒ–ç‰ˆï¼‰
            zoom: {
              pan: {
                enabled: true,
                mode: 'xy'
              },
              zoom: {
                wheel: {
                  enabled: true
                },
                pinch: {
                  enabled: true
                },
                mode: 'xy'
              }
            }
          },
          scales: {
            x: { 
              grid: { color: '#21262d' }, 
              ticks: { color: '#8b949e', maxTicksLimit: 20, maxRotation: 45 }
            },
            y: { 
              grid: { color: '#21262d' }, 
              ticks: { color: '#8b949e' }
            }
          }
        }
      });
    }
    
    function showLoading() {
      ['rulesContainer', 'waveHistoryContainer', 'fibContainer', 'recentDataContainer'].forEach(id => {
        document.getElementById(id).innerHTML = '<div class="loading"><div class="spinner"></div></div>';
      });
    }
    
    // ========== æŠ•è³‡çµ„åˆ ==========
    
    // ğŸ†• é‡æ–°ç²å–æ‰€æœ‰è‚¡ç¥¨çš„æ³¢æµªåˆ†æ
    async function refreshAllWaves() {
      const btn = event.target;
      btn.disabled = true;
      btn.textContent = 'â³ åˆ†æä¸­...';
      
      for (let i = 0; i < portfolio.length; i++) {
        const s = portfolio[i];
        if (s.id === 'CASH') continue;
        
        try {
          const res = await fetch(`/api/line/wave/analyze/${s.id}?_t=${Date.now()}`);
          if (res.ok) {
            const data = await res.json();
            if (data.currentWave && !data.error) {
              portfolio[i].wave = data.currentWave;
            }
          }
        } catch (e) {
          console.log(`${s.id} æ³¢æµªåˆ†æå¤±æ•—:`, e);
        }
        
        // é¿å… API éè¼‰
        await new Promise(r => setTimeout(r, 300));
      }
      
      btn.disabled = false;
      btn.textContent = 'ğŸ”„ é‡æ–°è¨ˆç®—';
      renderPortfolio();
    }
    
    function setBudget(val) {
      document.getElementById('budgetInput').value = val;
      document.querySelectorAll('.budget-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      renderPortfolio();
    }
    
    function renderPortfolio() {
      const budget = (parseInt(document.getElementById('budgetInput').value) || 60) * 10000;
      const container = document.getElementById('stockList');
      
      const data = portfolio.map(s => ({ ...s, amount: Math.round(budget * s.percent / 100) }));
      
      container.innerHTML = data.map((s, i) => {
        const waveColor = s.wave === '-' ? '#8b949e' : 
                          [1,2,'1','2'].includes(s.wave) ? '#3fb950' : 
                          [3,4,'3','4'].includes(s.wave) ? '#d29922' : '#f85149';
        return `
          <div class="stock-item">
            <div class="name">${s.id} ${s.name}</div>
            <div>
              <div class="sector">${s.sector}</div>
              <div style="color: #8b949e; font-size: 0.75rem;">${s.reason}</div>
            </div>
            <div class="amount">$${s.amount.toLocaleString()}</div>
            <input type="number" value="${s.percent}" min="0" max="100" onchange="updatePercent(${i}, this.value)" />
            <span class="wave-badge" style="background: ${waveColor}22; color: ${waveColor}; border: 1px solid ${waveColor}44;">
              ${s.wave === '-' ? 'ç¾é‡‘' : 'ç¬¬'+s.wave+'æµª'}
            </span>
            ${s.id !== 'CASH' ? `<button class="delete-btn" onclick="deleteStock(${i})">ğŸ—‘ï¸</button>` : '<span></span>'}
          </div>
        `;
      }).join('');
      
      const stockTotal = data.filter(p => p.id !== 'CASH').reduce((sum, p) => sum + p.amount, 0);
      const cashTotal = data.find(p => p.id === 'CASH')?.amount || 0;
      document.getElementById('sumBudget').textContent = '$' + budget.toLocaleString();
      document.getElementById('sumStock').textContent = '$' + stockTotal.toLocaleString();
      document.getElementById('sumCash').textContent = '$' + cashTotal.toLocaleString();
      
      calculateRisk(data);
      renderSectorBars(data);
    }
    
    function updatePercent(i, val) {
      portfolio[i].percent = parseInt(val) || 0;
      renderPortfolio();
    }
    
    function deleteStock(i) {
      if (confirm(`ç¢ºå®šåˆªé™¤ ${portfolio[i].name}ï¼Ÿ`)) {
        portfolio.splice(i, 1);
        renderPortfolio();
      }
    }
    
    async function addStock() {
      const id = document.getElementById('newId').value.trim();
      const name = document.getElementById('newName').value.trim();
      const sector = document.getElementById('newSector').value.trim() || 'å…¶ä»–';
      const percent = parseInt(document.getElementById('newPercent').value) || 5;
      const reason = document.getElementById('newReason').value.trim() || 'è‡ªè¨‚é…ç½®';
      
      if (!id || !name) return alert('è«‹è¼¸å…¥ä»£ç¢¼å’Œåç¨±');
      if (portfolio.find(s => s.id === id)) return alert('æ­¤è‚¡ç¥¨å·²å­˜åœ¨');
      
      // ğŸ†• è‡ªå‹•ç²å–æ³¢æµªåˆ†æ
      let wave = '?';
      try {
        const res = await fetch(`/api/line/wave/analyze/${id}?_t=${Date.now()}`);
        if (res.ok) {
          const data = await res.json();
          if (data.currentWave && !data.error) {
            wave = data.currentWave;
          }
        }
      } catch (e) {
        console.log('æ³¢æµªåˆ†æå¤±æ•—:', e);
      }
      
      portfolio.push({ id, name, sector, percent, wave, reason });
      ['newId', 'newName', 'newSector', 'newReason'].forEach(x => document.getElementById(x).value = '');
      document.getElementById('newPercent').value = '5';
      renderPortfolio();
    }
    
    function calculateRisk(data) {
      let score = 0, weight = 0;
      data.forEach(s => {
        if (s.id === 'CASH') return;
        let risk = 50;
        const w = s.wave;
        if ([1,2,'1','2'].includes(w)) risk = 25;
        else if ([3,'3'].includes(w)) risk = 40;
        else if ([4,'4'].includes(w)) risk = 55;
        else if ([5,'5'].includes(w)) risk = 70;
        else if (['A','B','C'].includes(w)) risk = 80;
        
        if (s.sector.includes('ETF')) risk -= 15;
        if (s.sector.includes('é‡‘è')) risk -= 10;
        if (s.sector.includes('è¨˜æ†¶é«”')) risk += 10;
        
        score += risk * s.percent;
        weight += s.percent;
      });
      
      const avg = weight > 0 ? Math.round(score / weight) : 50;
      document.getElementById('sumRiskScore').textContent = avg;
      document.getElementById('riskIndicator').style.left = avg + '%';
      document.getElementById('riskIndicator').textContent = avg;
      
      let level = 'ä½', color = '#3fb950', comment = 'çµ„åˆé¢¨éšªåä½ï¼Œé…ç½®ä¿å®ˆã€‚å¯é©åº¦å¢åŠ æˆé•·è‚¡æé«˜å ±é…¬ã€‚';
      if (avg >= 60) {
        level = 'é«˜'; color = '#f85149';
        comment = 'çµ„åˆé¢¨éšªè¼ƒé«˜ï¼Œå»ºè­°å¢åŠ é˜²ç¦¦æ€§æ¨™çš„ï¼ˆé«˜è‚¡æ¯ETFã€é‡‘èè‚¡ï¼‰é™ä½æ³¢å‹•ã€‚';
      } else if (avg >= 40) {
        level = 'ä¸­'; color = '#d29922';
        comment = 'çµ„åˆé¢¨éšªé©ä¸­ï¼Œæ”»å®ˆå…¼å‚™ã€‚å¯æ ¹æ“šå¸‚å ´ç‹€æ³é©åº¦èª¿æ•´ã€‚';
      }
      
      document.getElementById('sumRiskLevel').textContent = level;
      document.getElementById('sumRiskLevel').style.color = color;
      document.getElementById('riskComment').textContent = comment;
    }
    
    function renderSectorBars(data) {
      const sectors = {};
      const colors = { 'åŠå°é«”': '#58a6ff', 'ETF': '#3fb950', 'é‡‘è': '#d29922', 'è¨˜æ†¶é«”': '#f85149', 'ç¾é‡‘': '#8b949e', 'å…¶ä»–': '#a371f7' };
      
      data.forEach(p => {
        let cat = 'å…¶ä»–';
        if (p.id === 'CASH') cat = 'ç¾é‡‘';
        else if (p.sector.includes('åŠå°é«”') || p.sector.includes('IC')) cat = 'åŠå°é«”';
        else if (p.sector.includes('ETF')) cat = 'ETF';
        else if (p.sector.includes('é‡‘è')) cat = 'é‡‘è';
        else if (p.sector.includes('è¨˜æ†¶é«”')) cat = 'è¨˜æ†¶é«”';
        sectors[cat] = (sectors[cat] || 0) + p.percent;
      });
      
      document.getElementById('sectorBars').innerHTML = Object.entries(sectors)
        .sort((a, b) => b[1] - a[1])
        .map(([name, pct]) => `
          <div class="sector-row">
            <div class="name">${name}</div>
            <div class="bar-bg">
              <div class="bar-fill" style="width: ${pct}%; background: ${colors[name] || '#58a6ff'};">
                <span>${pct}%</span>
              </div>
            </div>
          </div>
        `).join('');
    }
    
    // ========== ğŸ†• ç¸®æ”¾åŠŸèƒ½ ==========
    function zoomIn() {
      if (priceChart) {
        priceChart.zoom(1.2);
      }
    }
    
    function zoomOut() {
      if (priceChart) {
        priceChart.zoom(0.8);
      }
    }
    
    function resetZoom() {
      if (priceChart) {
        priceChart.resetZoom();
      }
    }
    
    // ========== ğŸ†• æ³¢æµªç†è«–æ•™å­¸ ==========
    function showTheory() {
      document.getElementById('theoryModal').classList.add('show');
      document.body.style.overflow = 'hidden';
    }
    
    function hideTheory() {
      document.getElementById('theoryModal').classList.remove('show');
      document.body.style.overflow = '';
    }
    
    // é»æ“ŠèƒŒæ™¯é—œé–‰
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-overlay')) {
        hideTheory();
      }
    });
    
    // ESC éµé—œé–‰
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        hideTheory();
      }
    });
    
    // ==================== 3AI æ³¢æµªåˆ†æåŠŸèƒ½ ====================
    
    // åˆ‡æ› API è¨­å®šé¢æ¿
    function toggleAIKeyPanel() {
      const panel = document.getElementById('aiKeyPanel');
      panel.classList.toggle('show');
    }
    
    // è¼‰å…¥å·²å­˜çš„ API é‡‘é‘°
    function loadAIKeys() {
      try {
        const keys = JSON.parse(localStorage.getItem('wave_3ai_keys') || '{}');
        if (keys.claude) document.getElementById('claudeKeyInput').value = keys.claude;
        if (keys.gemini) document.getElementById('geminiKeyInput').value = keys.gemini;
        if (keys.openai) document.getElementById('openaiKeyInput').value = keys.openai;
      } catch (e) {}
    }
    
    // å„²å­˜ API é‡‘é‘°
    function saveAIKeys() {
      const keys = {
        claude: document.getElementById('claudeKeyInput').value.trim(),
        gemini: document.getElementById('geminiKeyInput').value.trim(),
        openai: document.getElementById('openaiKeyInput').value.trim()
      };
      localStorage.setItem('wave_3ai_keys', JSON.stringify(keys));
      alert('âœ… API é‡‘é‘°å·²å„²å­˜ï¼');
    }
    
    // æ¸…é™¤ API é‡‘é‘°
    function clearAIKeys() {
      if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ API é‡‘é‘°ï¼Ÿ')) {
        localStorage.removeItem('wave_3ai_keys');
        document.getElementById('claudeKeyInput').value = '';
        document.getElementById('geminiKeyInput').value = '';
        document.getElementById('openaiKeyInput').value = '';
        document.getElementById('claudeKeyStatus').textContent = '';
        document.getElementById('geminiKeyStatus').textContent = '';
        document.getElementById('openaiKeyStatus').textContent = '';
        alert('âœ… å·²æ¸…é™¤æ‰€æœ‰ API é‡‘é‘°');
      }
    }
    
    // æ¸¬è©¦ API é‡‘é‘°
    async function testAIKey(ai) {
      const inputId = ai + 'KeyInput';
      const statusId = ai + 'KeyStatus';
      const apiKey = document.getElementById(inputId).value.trim();
      const statusEl = document.getElementById(statusId);
      
      if (!apiKey) {
        statusEl.textContent = 'è«‹è¼¸å…¥é‡‘é‘°';
        statusEl.className = 'ai-key-status error';
        return;
      }
      
      statusEl.textContent = 'æ¸¬è©¦ä¸­...';
      statusEl.className = 'ai-key-status testing';
      
      try {
        let result = false;
        if (ai === 'claude') result = await testClaudeKey(apiKey);
        else if (ai === 'gemini') result = await testGeminiKey(apiKey);
        else if (ai === 'openai') result = await testOpenAIKey(apiKey);
        
        if (result) {
          statusEl.textContent = 'âœ“ æœ‰æ•ˆ';
          statusEl.className = 'ai-key-status success';
        } else {
          statusEl.textContent = 'âœ— ç„¡æ•ˆ';
          statusEl.className = 'ai-key-status error';
        }
      } catch (e) {
        statusEl.textContent = 'âœ— éŒ¯èª¤';
        statusEl.className = 'ai-key-status error';
      }
    }
    
    async function testClaudeKey(apiKey) {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': apiKey,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 10,
          messages: [{ role: 'user', content: 'Hi' }]
        })
      });
      return response.ok;
    }
    
    async function testGeminiKey(apiKey) {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: 'Hi' }] }],
          generationConfig: { maxOutputTokens: 10 }
        })
      });
      return response.ok;
    }
    
    async function testOpenAIKey(apiKey) {
      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'gpt-4o-mini',
          messages: [{ role: 'user', content: 'Hi' }],
          max_tokens: 10
        })
      });
      return response.ok;
    }
    
    // å‘¼å« Claude API
    async function callClaudeAPI(prompt, apiKey) {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': apiKey,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1500,
          messages: [{ role: 'user', content: prompt }]
        })
      });
      if (!response.ok) throw new Error('Claude API éŒ¯èª¤');
      const data = await response.json();
      return data.content[0].text;
    }
    
    // å‘¼å« Gemini API
    async function callGeminiAPI(prompt, apiKey) {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }],
          generationConfig: { maxOutputTokens: 1500, temperature: 0.7 }
        })
      });
      if (!response.ok) throw new Error('Gemini API éŒ¯èª¤');
      const data = await response.json();
      return data.candidates[0].content.parts[0].text;
    }
    
    // å‘¼å« OpenAI API
    async function callOpenAIAPI(prompt, apiKey) {
      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'gpt-4o-mini',
          messages: [{ role: 'user', content: prompt }],
          max_tokens: 1500,
          temperature: 0.7
        })
      });
      if (!response.ok) throw new Error('OpenAI API éŒ¯èª¤');
      const data = await response.json();
      return data.choices[0].message.content;
    }
    
    // è§£æ AI æ³¢æµªå›æ‡‰
    function parseWaveResponse(response) {
      let wave = null;
      let score = 50;
      let analysis = '';
      
      // è§£ææ³¢æµªåˆ¤æ–·
      const waveMatch = response.match(/ã€æ³¢æµªåˆ¤æ–·ã€‘\s*ç¬¬?\s*([1-5ABC])\s*æµª/i);
      if (waveMatch) {
        wave = waveMatch[1].toUpperCase();
        if (/[1-5]/.test(wave)) wave = parseInt(wave);
      }
      
      // è§£æä¿¡å¿ƒåˆ†æ•¸
      const scoreMatch = response.match(/ã€ä¿¡å¿ƒåˆ†æ•¸ã€‘\s*(\d+)/);
      if (scoreMatch) {
        score = Math.min(100, Math.max(0, parseInt(scoreMatch[1])));
      }
      
      // è§£æåˆ†æå…§å®¹
      const analysisMatch = response.match(/ã€åˆ†æèªªæ˜ã€‘\s*([\s\S]*?)(?=ã€|$)/);
      if (analysisMatch) {
        analysis = analysisMatch[1].trim().slice(0, 200);
      }
      
      return { wave, score, analysis };
    }
    
    // åŸ·è¡Œ 3AI æ³¢æµªåˆ†æ
    async function run3AIWaveAnalysis() {
      if (!currentWaveData) {
        alert('è«‹å…ˆåˆ†æè‚¡ç¥¨å¾Œå†ä½¿ç”¨ 3AI åˆ†æ');
        return;
      }
      
      const keys = JSON.parse(localStorage.getItem('wave_3ai_keys') || '{}');
      const activeAIs = [];
      if (keys.claude) activeAIs.push({ name: 'Claude', key: keys.claude, icon: 'ğŸŸ£', call: callClaudeAPI });
      if (keys.gemini) activeAIs.push({ name: 'Gemini', key: keys.gemini, icon: 'ğŸ”µ', call: callGeminiAPI });
      if (keys.openai) activeAIs.push({ name: 'OpenAI', key: keys.openai, icon: 'ğŸŸ¢', call: callOpenAIAPI });
      
      if (activeAIs.length === 0) {
        alert('è«‹å…ˆè¨­å®šè‡³å°‘ä¸€å€‹ AI çš„ API é‡‘é‘°');
        toggleAIKeyPanel();
        return;
      }
      
      const btn = document.getElementById('aiWaveBtn');
      btn.disabled = true;
      btn.textContent = 'â³ åˆ†æä¸­...';
      
      const resultsDiv = document.getElementById('aiWaveResults');
      resultsDiv.innerHTML = '<div class="ai-loading"><div class="spinner"></div><div>3AI æ­£åœ¨åˆ†ææ³¢æµªçµæ§‹...</div></div>';
      
      // å»ºç«‹ prompt
      const data = currentWaveData;
      const prompt = `ä½ æ˜¯è‰¾ç•¥ç‰¹æ³¢æµªç†è«–å°ˆå®¶ã€‚è«‹åˆ†æä»¥ä¸‹è‚¡ç¥¨æ•¸æ“šï¼Œåˆ¤æ–·ç›®å‰è™•æ–¼ç¬¬å¹¾æµªã€‚

ã€è‚¡ç¥¨è³‡è¨Šã€‘
è‚¡ç¥¨: ${data.stockName} (${data.stockId})
ç¾åƒ¹: ${data.currentPrice}
æ¼²è·Œ: ${data.changePercent?.toFixed(2)}%

ã€æ­·å²æ³¢æµªã€‘
${(data.waves || []).map(w => `ç¬¬${w.wave}æµª: ${w.start} â†’ ${w.end} (${w.change}%)`).join('\n')}

ã€æŠ€è¡“åˆ†æç³»çµ±åˆ¤æ–·ã€‘
ç³»çµ±åˆ¤æ–·: ç¬¬${data.currentWave}æµª
ä¿¡å¿ƒåº¦: ${data.confidence}%

è«‹æ ¹æ“šä»¥ä¸Šæ•¸æ“šï¼Œç¨ç«‹åˆ¤æ–·ç›®å‰è™•æ–¼ç¬¬å¹¾æµªï¼Œä¸¦çµ¦å‡ºä½ çš„ä¿¡å¿ƒåˆ†æ•¸ã€‚

âš ï¸ åš´æ ¼ä¾ç…§ä»¥ä¸‹æ ¼å¼å›è¦†ï¼š
ã€æ³¢æµªåˆ¤æ–·ã€‘ç¬¬ X æµª
ã€ä¿¡å¿ƒåˆ†æ•¸ã€‘XXï¼ˆ0-100ï¼‰
ã€åˆ†æèªªæ˜ã€‘ç°¡è¿°ä½ çš„åˆ¤æ–·ç†ç”±ï¼ˆ100å­—å…§ï¼‰`;

      const results = [];
      
      // ä¸¦è¡Œå‘¼å«æ‰€æœ‰ AI
      const promises = activeAIs.map(async (ai) => {
        try {
          const response = await ai.call(prompt, ai.key);
          const parsed = parseWaveResponse(response);
          return { ...ai, ...parsed, success: true, raw: response };
        } catch (e) {
          return { ...ai, success: false, error: e.message };
        }
      });
      
      const aiResults = await Promise.all(promises);
      
      // è¨ˆç®—å¹³å‡åˆ†æ•¸
      const validResults = aiResults.filter(r => r.success && r.wave !== null);
      let avgScore = 0;
      let finalWave = data.currentWave;
      let closestAI = null;
      
      if (validResults.length > 0) {
        avgScore = validResults.reduce((sum, r) => sum + r.score, 0) / validResults.length;
        
        // æ‰¾å‡ºæœ€æ¥è¿‘å¹³å‡åˆ†çš„ AI
        let minDiff = Infinity;
        for (const r of validResults) {
          const diff = Math.abs(r.score - avgScore);
          if (diff < minDiff) {
            minDiff = diff;
            closestAI = r;
          }
        }
        
        if (closestAI) {
          finalWave = closestAI.wave;
        }
      }
      
      // æ¸²æŸ“çµæœ
      let html = '<div class="ai-results-grid">';
      
      for (const r of aiResults) {
        const isWinner = closestAI && r.name === closestAI.name;
        const waveColor = waveColors[String(r.wave)] || '#58a6ff';
        
        html += `
          <div class="ai-result-card ${isWinner ? 'winner' : ''}">
            <div class="ai-name">${r.icon} ${r.name} ${isWinner ? 'ğŸ‘‘' : ''}</div>
            ${r.success ? `
              <div class="ai-wave-result">
                <div style="font-size: 0.8rem; color: #8b949e;">åˆ¤æ–·æ³¢æµª</div>
                <div class="wave-num-display" style="color: ${waveColor};">ç¬¬ ${r.wave} æµª</div>
                <div class="wave-score">ä¿¡å¿ƒåˆ†æ•¸: <strong>${r.score}</strong>/100</div>
              </div>
              <div class="ai-analysis">${r.analysis || 'ç„¡è©³ç´°åˆ†æ'}</div>
            ` : `
              <div style="color: #f85149; padding: 20px; text-align: center;">
                âŒ åˆ†æå¤±æ•—<br><small>${r.error}</small>
              </div>
            `}
          </div>
        `;
      }
      
      html += '</div>';
      
      // æœ€çµ‚è£æ±º
      if (validResults.length > 0) {
        const verdictColor = waveColors[String(finalWave)] || '#f59e0b';
        html += `
          <div class="ai-verdict-box">
            <div class="ai-verdict-title">ğŸ† 3AI æ³¢æµªè£æ±º</div>
            <div class="ai-verdict-wave" style="color: ${verdictColor};">ç¬¬ ${finalWave} æµª</div>
            <div class="ai-verdict-summary">
              ${closestAI ? closestAI.analysis : ''}
            </div>
            <div class="ai-verdict-meta">
              å¹³å‡ä¿¡å¿ƒåˆ†æ•¸: ${avgScore.toFixed(1)} | è£æ±º AI: ${closestAI?.name || '-'} | 
              ${validResults.length} å€‹ AI åƒèˆ‡åˆ†æ
            </div>
          </div>
        `;
      }
      
      resultsDiv.innerHTML = html;
      
      btn.disabled = false;
      btn.textContent = 'ğŸš€ å•Ÿå‹• 3AI åˆ†æ';
    }
  </script>
  
  <!-- ğŸ†• æ³¢æµªç†è«–æ•™å­¸ Modal -->
  <div id="theoryModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ“š è‰¾ç•¥ç‰¹æ³¢æµªç†è«–æ•™å­¸</h2>
        <button class="modal-close" onclick="hideTheory()">âœ•</button>
      </div>
      <div class="modal-body">
        <!-- ä¸»åœ– -->
        <div style="text-align: center; margin-bottom: 24px;">
          <img src="https://i.imgur.com/YourWaveTheoryImage.png" alt="è‰¾ç•¥ç‰¹æ³¢æµªç†è«–" 
               onerror="this.style.display='none'" />
        </div>
        
        <!-- ç†è«–èªªæ˜ -->
        <div style="background: #0d1117; border-radius: 12px; padding: 20px; margin-bottom: 24px; border: 1px solid #30363d;">
          <h3 style="color: #58a6ff; margin-bottom: 12px;">ğŸ“– ä»€éº¼æ˜¯è‰¾ç•¥ç‰¹æ³¢æµªç†è«–ï¼Ÿ</h3>
          <p style="color: #c9d1d9; line-height: 1.8; font-size: 0.95rem;">
            è‰¾ç•¥ç‰¹æ³¢æµªç†è«–ç”± Ralph Nelson Elliott åœ¨ 1930 å¹´ä»£æå‡ºï¼Œèªç‚ºå¸‚å ´åƒ¹æ ¼è®Šå‹•éµå¾ªä¸€ç¨®å¯é æ¸¬çš„è‡ªç„¶è¦å¾‹ã€‚
            <br><br>
            å®Œæ•´çš„å¸‚å ´å¾ªç’°åŒ…å« <strong style="color: #238636;">8 å€‹æ³¢æµª</strong>ï¼š
            <br>â€¢ <strong>æ¨å‹•æµª (1-5)</strong>ï¼šé †è‘—ä¸»è¦è¶¨å‹¢æ–¹å‘çš„ 5 å€‹æ³¢æµª
            <br>â€¢ <strong>ä¿®æ­£æµª (A-B-C)</strong>ï¼šé€†è‘—ä¸»è¦è¶¨å‹¢æ–¹å‘çš„ 3 å€‹æ³¢æµª
          </p>
        </div>
        
        <!-- æ³¢æµªå¡ç‰‡ -->
        <h3 style="color: #c9d1d9; margin-bottom: 16px;">ğŸŒŠ å„æ³¢æµªç‰¹æ€§</h3>
        <div class="wave-theory-grid">
          <!-- ç¬¬ 1 æµª -->
          <div class="wave-theory-card">
            <h3><span class="wave-num" style="background:#238636; color:white;">1</span> ç¬¬ 1 æµª - åˆå‡æ®µ</h3>
            <p>è‚¡ç¥¨é¦–æ¬¡å‡ºç¾ä¸Šæ¼²ï¼Œé€šå¸¸æ˜¯å› ç‚ºè©²æ”¯è‚¡ç¥¨çš„åƒ¹æ ¼å¾ˆä¾¿å®œï¼Œé©åˆè²·åœ¨å¾ˆçŸ­æ™‚é–“å…§è²·äº†ä¸€éƒ¨åˆ†è©²æ”¯è‚¡ç¥¨ï¼Œé€²è€Œå°è‡´äº†åƒ¹æ ¼ä¸Šæ¼²ã€‚</p>
            <div class="keywords">
              <span class="keyword">ä¾¿å®œè²·å…¥</span>
              <span class="keyword">ç²åˆ©äº†çµ</span>
              <span class="keyword">æ‡·ç–‘éšæ®µ</span>
            </div>
          </div>
          
          <!-- ç¬¬ 2 æµª -->
          <div class="wave-theory-card">
            <h3><span class="wave-num" style="background:#1f6feb; color:white;">2</span> ç¬¬ 2 æµª - å›èª¿æ®µ</h3>
            <p>åŸä¾†å·²ç¶“æŒæœ‰è©²æ”¯è‚¡ç¥¨çš„ä¸€éƒ¨åˆ†äººèªç‚ºè‚¡ç¥¨åƒ¹æ ¼éé«˜ï¼Œç²åˆ©äº†çµï¼Œé€²è€Œå°è‡´äº†è‚¡ç¥¨åƒ¹æ ¼çš„ä¸‹è·Œã€‚ä½†è©²æ”¯è‚¡ç¥¨ä¸¦æ²’æœ‰è·Œåˆ°æ³¢æµª1çš„æœ€ä½é»ã€‚</p>
            <div class="keywords">
              <span class="keyword">ç²åˆ©äº†çµ</span>
              <span class="keyword">ä¸ç ´èµ·é»</span>
              <span class="keyword">å›èª¿ 38%-62%</span>
            </div>
          </div>
          
          <!-- ç¬¬ 3 æµª -->
          <div class="wave-theory-card">
            <h3><span class="wave-num" style="background:#238636; color:white;">3</span> ç¬¬ 3 æµª - ä¸»å‡æ®µ â­</h3>
            <p>é€šå¸¸æ˜¯æœ€å¼·å‹¢ä¹Ÿæ˜¯æœ€é•·çš„ä¸€æµªã€‚è©²æ”¯è‚¡ç¥¨å¸å¼•äº†å…¬çœ¾çš„ç›®å…‰ï¼Œæ›´å¤šçš„äººé–‹å§‹è²·å…¥ï¼Œä¸¦é–‹å§‹è²·å…¥ï¼Œé€™å°è‡´äº†è‚¡ç¥¨åƒ¹æ ¼çš„æŒçºŒæ”€å‡ã€‚é€™ä¸€æµªçš„é«˜é»çªç ´äº†æ³¢æµª1çš„æœ€é«˜é»ã€‚</p>
            <div class="keywords">
              <span class="keyword" style="background:rgba(35,134,54,0.3); color:#3fb950;">æœ€é•·æ³¢æµª</span>
              <span class="keyword">å…¬çœ¾åƒèˆ‡</span>
              <span class="keyword">é‡åƒ¹é½Šæš</span>
            </div>
          </div>
          
          <!-- ç¬¬ 4 æµª -->
          <div class="wave-theory-card">
            <h3><span class="wave-num" style="background:#1f6feb; color:white;">4</span> ç¬¬ 4 æµª - æ•´ç†æ®µ</h3>
            <p>ä¸€éƒ¨åˆ†äººèªç‚ºè‚¡ç¥¨åƒ¹æ ¼éé«˜ï¼Œé–‹å§‹ç²åˆ©äº†çµã€‚é€™ä¸€æµªé€šå¸¸ä¸æœƒå¤ªå¼·ï¼Œå› ç‚ºé‚„æœ‰æ›´å¤šçš„äººçœ‹å¥½è©²æ”¯è‚¡ç¥¨çš„æ¼²å‹¢ã€‚</p>
            <div class="keywords">
              <span class="keyword">ä¸é‡ç–Šç¬¬1æµª</span>
              <span class="keyword">æ•´ç†è“„å‹¢</span>
              <span class="keyword">å›èª¿è¼ƒæ·º</span>
            </div>
          </div>
          
          <!-- ç¬¬ 5 æµª -->
          <div class="wave-theory-card">
            <h3><span class="wave-num" style="background:#238636; color:white;">5</span> ç¬¬ 5 æµª - æœ«å‡æ®µ âš ï¸</h3>
            <p>æ³¢æµª5é€šå¸¸æ˜¯å¸‚å ´ä¸Šçµ•å¤§å¤šæ•¸äººé—œæ³¨è©²æ”¯è‚¡ç¥¨çš„æ™‚åˆ»ï¼Œè€Œä¸”é€šå¸¸è¼ƒä¸ç†æ€§ã€‚äººå€‘å¯èƒ½æœƒçœ‹åˆ°è©²å…¬å¸çš„CEOç™»ä¸Šå„ç¨®åª’é«”çš„å°é¢ï¼Œæˆç‚ºå¹´åº¦äººç‰©ã€‚äººå€‘æœƒæ‰¾å„ç¨®å¥‡æ€ªçš„ç†ç”±è²·å…¥è©²æ”¯è‚¡ç¥¨ã€‚</p>
            <div class="keywords">
              <span class="keyword" style="background:rgba(210,153,34,0.3); color:#d29922;">åš´é‡é«˜ä¼°</span>
              <span class="keyword">åª’é«”é—œæ³¨</span>
              <span class="keyword">æº–å‚™å‡ºå ´</span>
            </div>
          </div>
          
          <!-- A æµª -->
          <div class="wave-theory-card">
            <h3><span class="wave-num" style="background:#da3633; color:white;">A</span> A æµª - ä¸‹è·Œé–‹å§‹</h3>
            <p>Aæµªæ˜¯ä¸‹è·Œçš„é–‹å§‹ï¼Œä½†æŠ•è³‡è€…å¤§å¤šèªç‚ºæ˜¯ä¸Šå‡è¡Œæƒ…å°šæœªé€†è½‰ï¼Œåƒ…ç‚ºä¸€å€‹æš«æ™‚çš„å›æª”ç¾è±¡ã€‚å¯¦éš›ä¸Šï¼ŒAæµªçš„ä¸‹è·Œåœ¨ç¬¬5æµªä¸­é€šå¸¸å·²æœ‰è­¦å‘Šè¨Šè™Ÿã€‚</p>
            <div class="keywords">
              <span class="keyword" style="background:rgba(218,54,51,0.3); color:#f85149;">ä¸‹è·Œé–‹å§‹</span>
              <span class="keyword">å¤šæ•¸æœªé€ƒ</span>
              <span class="keyword">åƒ¥å€–å¿ƒç†</span>
            </div>
          </div>
          
          <!-- B æµª -->
          <div class="wave-theory-card">
            <h3><span class="wave-num" style="background:#d29922; color:white;">B</span> B æµª - åå½ˆé™·é˜±</h3>
            <p>Bæµªæ˜¯å°Aæµªçš„åå½ˆï¼Œä½†æ˜¯æˆäº¤é‡ä¸å¤§ï¼Œä¸€èˆ¬è€Œè¨€æ˜¯å¤šé ­çš„é€ƒå‘½ç·šã€‚ç”±æ–¼å¤§å¤šæ•¸æŠ•è³‡è€…æœƒä»¥ç‚ºæ˜¯å¦ä¸€æ³¢æ®µçš„æ¼²å‹¢ï¼Œå› è€ŒBæµªå½¢æˆã€Œå¤šé ­é™·é˜±ã€ã€‚</p>
            <div class="keywords">
              <span class="keyword" style="background:rgba(210,153,34,0.3); color:#d29922;">å¤šé ­é™·é˜±</span>
              <span class="keyword">é€ƒå‘½ç·š</span>
              <span class="keyword">é‡èƒ½èç¸®</span>
            </div>
          </div>
          
          <!-- C æµª -->
          <div class="wave-theory-card">
            <h3><span class="wave-num" style="background:#da3633; color:white;">C</span> C æµª - ä¸»è·Œæ®µ ğŸ’€</h3>
            <p>Cæµªæ˜¯ä¸€æ®µç ´å£åŠ›è¼ƒå¼·çš„ä¸‹è·Œï¼Œè·Œå¹…å¤§ã€æŒçºŒæ™‚é–“é•·ï¼Œè€Œä¸”å‡ºç¾å…¨é¢æ€§ä¸‹è·Œã€‚æŠ•è³‡è€…åœ¨æ­¤è¢«å›°ä½ï¼Œæœ€å¾Œçµ•æœ›è³£å‡ºã€‚</p>
            <div class="keywords">
              <span class="keyword" style="background:rgba(218,54,51,0.3); color:#f85149;">å…¨é¢ä¸‹è·Œ</span>
              <span class="keyword">è·Œå¹…æœ€å¤§</span>
              <span class="keyword">çµ•æœ›å‡ºå ´</span>
            </div>
          </div>
        </div>
        
        <!-- ä¸‰å¤§è¦å‰‡ -->
        <div style="background: #0d1117; border-radius: 12px; padding: 20px; margin-top: 24px; border: 1px solid #30363d;">
          <h3 style="color: #58a6ff; margin-bottom: 12px;">ğŸ“‹ è‰¾ç•¥ç‰¹ä¸‰å¤§éµå¾‹</h3>
          <div style="display: grid; gap: 12px;">
            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #161b22; border-radius: 8px;">
              <span style="background: #238636; color: white; padding: 4px 10px; border-radius: 4px; font-weight: 700;">1</span>
              <span style="color: #c9d1d9;">ç¬¬ 2 æµªçš„ä½é»<strong style="color: #f85149;">ä¸èƒ½è·Œç ´</strong>ç¬¬ 1 æµªçš„èµ·é»</span>
            </div>
            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #161b22; border-radius: 8px;">
              <span style="background: #238636; color: white; padding: 4px 10px; border-radius: 4px; font-weight: 700;">2</span>
              <span style="color: #c9d1d9;">ç¬¬ 3 æµª<strong style="color: #f85149;">ä¸èƒ½æ˜¯æœ€çŸ­</strong>çš„æ¨å‹•æµªï¼ˆ1ã€3ã€5 ä¸­ï¼‰</span>
            </div>
            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #161b22; border-radius: 8px;">
              <span style="background: #238636; color: white; padding: 4px 10px; border-radius: 4px; font-weight: 700;">3</span>
              <span style="color: #c9d1d9;">ç¬¬ 4 æµªçš„ä½é»<strong style="color: #f85149;">ä¸èƒ½é‡ç–Š</strong>ç¬¬ 1 æµªçš„åƒ¹æ ¼å€é–“</span>
            </div>
          </div>
        </div>
        
        <!-- æ“ä½œå»ºè­°è¡¨ -->
        <div style="background: #0d1117; border-radius: 12px; padding: 20px; margin-top: 24px; border: 1px solid #30363d;">
          <h3 style="color: #58a6ff; margin-bottom: 12px;">ğŸ’¡ å„æ³¢æµªæ“ä½œå»ºè­°</h3>
          <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
            <thead>
              <tr style="border-bottom: 1px solid #30363d;">
                <th style="padding: 10px; text-align: left; color: #8b949e;">æ³¢æµª</th>
                <th style="padding: 10px; text-align: left; color: #8b949e;">å»ºè­°æ“ä½œ</th>
                <th style="padding: 10px; text-align: left; color: #8b949e;">é¢¨éšªç­‰ç´š</th>
              </tr>
            </thead>
            <tbody>
              <tr style="border-bottom: 1px solid #21262d;">
                <td style="padding: 10px;"><span style="background:#238636; color:white; padding:2px 8px; border-radius:4px;">1</span></td>
                <td style="padding: 10px; color: #c9d1d9;">å°é‡è©¦å–®ï¼Œè¨­åœææ–¼èµ·æ¼²é»ä¸‹æ–¹</td>
                <td style="padding: 10px;"><span style="color:#d29922;">ä¸­ç­‰</span></td>
              </tr>
              <tr style="border-bottom: 1px solid #21262d;">
                <td style="padding: 10px;"><span style="background:#1f6feb; color:white; padding:2px 8px; border-radius:4px;">2</span></td>
                <td style="padding: 10px; color: #c9d1d9;">ç­‰å¾…å›èª¿è‡³ 38%-62% æ–æ³¢é‚£å¥‘ä½ç½®é€²å ´</td>
                <td style="padding: 10px;"><span style="color:#3fb950;">è¼ƒä½</span></td>
              </tr>
              <tr style="border-bottom: 1px solid #21262d;">
                <td style="padding: 10px;"><span style="background:#238636; color:white; padding:2px 8px; border-radius:4px;">3</span></td>
                <td style="padding: 10px; color: #c9d1d9;">â­ æœ€ä½³é€²å ´é»ï¼çªç ´ç¬¬1æµªé«˜é»åŠ ç¢¼</td>
                <td style="padding: 10px;"><span style="color:#3fb950;">è¼ƒä½</span></td>
              </tr>
              <tr style="border-bottom: 1px solid #21262d;">
                <td style="padding: 10px;"><span style="background:#1f6feb; color:white; padding:2px 8px; border-radius:4px;">4</span></td>
                <td style="padding: 10px; color: #c9d1d9;">æŒæœ‰è§€æœ›ï¼Œå›èª¿ä¸æ·±å¯å°é‡åŠ ç¢¼</td>
                <td style="padding: 10px;"><span style="color:#d29922;">ä¸­ç­‰</span></td>
              </tr>
              <tr style="border-bottom: 1px solid #21262d;">
                <td style="padding: 10px;"><span style="background:#238636; color:white; padding:2px 8px; border-radius:4px;">5</span></td>
                <td style="padding: 10px; color: #c9d1d9;">âš ï¸ æº–å‚™å‡ºå ´ï¼åˆ†æ‰¹ç²åˆ©äº†çµ</td>
                <td style="padding: 10px;"><span style="color:#f85149;">è¼ƒé«˜</span></td>
              </tr>
              <tr style="border-bottom: 1px solid #21262d;">
                <td style="padding: 10px;"><span style="background:#da3633; color:white; padding:2px 8px; border-radius:4px;">A</span></td>
                <td style="padding: 10px; color: #c9d1d9;">åœæå‡ºå ´ï¼Œä¸è¦æŠ„åº•</td>
                <td style="padding: 10px;"><span style="color:#f85149;">é«˜</span></td>
              </tr>
              <tr style="border-bottom: 1px solid #21262d;">
                <td style="padding: 10px;"><span style="background:#d29922; color:white; padding:2px 8px; border-radius:4px;">B</span></td>
                <td style="padding: 10px; color: #c9d1d9;">âš ï¸ å¤šé ­é™·é˜±ï¼åå½ˆæ¸›ç¢¼</td>
                <td style="padding: 10px;"><span style="color:#f85149;">æ¥µé«˜</span></td>
              </tr>
              <tr>
                <td style="padding: 10px;"><span style="background:#da3633; color:white; padding:2px 8px; border-radius:4px;">C</span></td>
                <td style="padding: 10px; color: #c9d1d9;">è§€æœ›ç­‰å¾…ï¼Œæ¥è¿‘å°¾è²å¯ç•™æ„è½‰æŠ˜</td>
                <td style="padding: 10px;"><span style="color:#f85149;">æ¥µé«˜</span></td>
              </tr>
            </tbody>
          </table>
        </div>
        
      </div>
    </div>
  </div>
</body>
</html>
